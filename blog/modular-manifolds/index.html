<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="author" content="">

  
  
  <meta name="description" content="A geometric framework for co-designing neural net optimizers with manifold constraints.">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">

  
  
  
  <link rel="preload" href="/fonts/iowan-old-style/iowan-old-style_regular.woff2" as="font" type="font/woff2" crossorigin="anonymous" fetchpriority="high">
  <link rel="preload" href="/fonts/iowan-old-style/iowan-old-style_bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/fonts/iowan-old-style/iowan-old-style_italic.woff2" as="font" type="font/woff2" crossorigin="anonymous" fetchpriority="high">
  
  
  <link rel="preload" href="/fonts/gt-america/GT-America-Standard-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/fonts/gt-america/GT-America-Standard-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/fonts/gt-america/GT-America-Standard-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/fonts/chakra-petch/chakra-petch-v12-latin-regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/fonts/chakra-petch/chakra-petch-v12-latin-500.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/fonts/chakra-petch/chakra-petch-v12-latin-600.woff2" as="font" type="font/woff2" crossorigin="anonymous">

  
  
  <meta name="keywords" content='thinky thinkingmachines machine learning deep learning ai'>
  

  
  
  

<script>
  
  (function() {
    function pageHasMath() {
      try {
        const text = document.body ? document.body.textContent : '';
        if (!text) return false;
        
        const block = /\$\$[\s\S]*?\$\$/;
        const paren = /\\\([\s\S]*?\\\)/;
        const bracket = /\\\[[\s\S]*?\\\]/;
        const inline = /(^|\s)\$(?!\$)[^\n]+?\$(?=\s|[\.,;:!?)]|$)/;
        return block.test(text) || paren.test(text) || bracket.test(text) || inline.test(text);
      } catch (e) {
        return true; 
      }
    }

    function loadStyle(href) {
      var preload = document.createElement('link');
      preload.rel = 'preload';
      preload.as = 'style';
      preload.href = href;
      document.head.appendChild(preload);

      var link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = href;
      link.media = 'print';
      link.onload = function(){ this.media = 'all'; };
      document.head.appendChild(link);

      var noscript = document.createElement('noscript');
      noscript.innerHTML = '<link rel="stylesheet" href="' + href + '">';
      document.head.appendChild(noscript);
    }

    function loadScript(src) {
      return new Promise(function(resolve, reject) {
        var s = document.createElement('script');
        s.src = src;
        s.defer = true;
        s.onload = resolve;
        s.onerror = reject;
        document.head.appendChild(s);
      });
    }

    function renderAllMath(root) {
      if (!window.renderMathInElement) return;
      window.renderMathInElement(root || document.body, {
        delimiters: [
          {left: '$$', right: '$$', display: true},
          {left: '$', right: '$', display: false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ],
        throwOnError: false,
        
        ignoredTags: ['script','noscript','style','textarea','pre','code'],
      });
    }

    function init() {
      if (!pageHasMath()) return;
      var base = '\/katex\/';
      var cssHref = base + 'katex.min.css?v=1762541520';
      var katexJs = base + 'katex.min.js?v=1762541520';
      var autorenderJs = base + 'contrib/auto-render.min.js?v=1762541520';

      loadStyle(cssHref);
      loadScript(katexJs)
        .then(function(){ return loadScript(autorenderJs); })
        .then(function(){
          
          renderAllMath(document.body);
          
          setTimeout(function(){ renderAllMath(document.body); }, 0);
          
          try {
            var observer = new MutationObserver(function(mutations){
              for (var i=0; i<mutations.length; i++) {
                var m = mutations[i];
                if (m.addedNodes && m.addedNodes.length) {
                  for (var j=0; j<m.addedNodes.length; j++) {
                    var node = m.addedNodes[j];
                    if (node.nodeType === 1) {
                      renderAllMath(node);
                    }
                  }
                }
              }
            });
            observer.observe(document.body, { childList: true, subtree: true });
          } catch (e) {   }
        })
        .catch(function(){   });
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
</script>


  

  
  
  
  
    
  

  
  
  
  
  
  
  
    
  
  
  
    
  

  
  
  
  
  

  
  <link rel="canonical" href="https://thinkingmachines.ai/blog/modular-manifolds/">

  
  
  
  <meta itemprop="name" content="Modular Manifolds">
  <meta itemprop="description" content="A geometric framework for co-designing neural net optimizers with manifold constraints.">
  <meta itemprop="datePublished" content="2025-09-26T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-09-26T00:00:00+00:00">
  <meta itemprop="wordCount" content="4407">



  
  
  
  
  <link rel="stylesheet" href="/css/common.css?v=1762541520" fetchpriority="high">
  
  <link rel="stylesheet" href="https://thinkingmachines.ai/css/ui.css?v=1762541520">
  
  <link rel="preload" as="style" href="/css/typography.css?v=1762541520">
  <link rel="stylesheet" href="/css/typography.css?v=1762541520" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="/css/typography.css?v=1762541520"></noscript>
  
  <link rel="preload" as="style" href="/css/fonts.css?v=1762541520">
  <link rel="stylesheet" href="/css/fonts.css?v=1762541520" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="/css/fonts.css?v=1762541520"></noscript>
  <link rel="preload" as="style" href="/css/syntax.css?v=1762541520">
  <link rel="stylesheet" href="/css/syntax.css?v=1762541520" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="/css/syntax.css?v=1762541520"></noscript>

  
  
  <title>Modular Manifolds - Thinking Machines Lab</title>
  

  
  
  
  
  
  
    
    
    
      
        
          
          
          
          
        
      
    
  
  
  
  
  
    
    
    
    
      
    
  

  
  <meta property="og:title" content="Modular Manifolds">
  <meta property="og:description" content="A geometric framework for co-designing neural net optimizers with manifold constraints.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://thinkingmachines.ai/blog/modular-manifolds/">
  <meta property="og:site_name" content="Thinking Machines Lab">
  <meta property="og:image" content="https://thinkingmachines.ai/blog/modular-manifolds/images/mm-cover-social.png">
  <meta property="og:image:width" content="3600">
  <meta property="og:image:height" content="1890">
  <meta property="og:image:alt" content="Modular Manifolds">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Modular Manifolds">
  <meta name="twitter:description" content="A geometric framework for co-designing neural net optimizers with manifold constraints.">
  <meta name="twitter:image" content="https://thinkingmachines.ai/blog/modular-manifolds/images/mm-cover-social.png">
  <meta name="twitter:image:width" content="3600">
  <meta name="twitter:image:height" content="1890">
  <meta name="twitter:image:alt" content="Modular Manifolds">

  




<link rel="preload" as="style" href="https://thinkingmachines.ai/css/blog-post.css?v=1762541520">
<link rel="stylesheet" href="https://thinkingmachines.ai/css/blog-post.css?v=1762541520" media="print" onload="this.media='all'">
<noscript><link rel="stylesheet" href="https://thinkingmachines.ai/css/blog-post.css?v=1762541520"></noscript>



</head>

<body>
  <div id="wrapper">
    






<header id="header">
  
  <div id="site-header" class="site-header">
    
    
    <div class="navbar-logo">
      <a href="/">THINKING MACHINES</a>
    </div>
    

    
    <div class="nav-group">
      
      <nav class="top-nav">
        
        <a href="/tinker/">Tinker</a>
        
        <a href="/blog/">Blog</a>
        <a href="/#join-us">Join us</a>
      </nav>

      
      <button id="menu-toggle" class="hamburger" aria-label="Open menu" aria-expanded="false" aria-controls="mobile-menu" type="button">
        <span></span>
        <span></span>
        <span></span>
      </button>
      
    </div>
  </div>
  
  
  <div id="mobile-menu" class="mobile-menu-overlay" aria-hidden="true">
    <nav class="mobile-menu-nav" role="navigation" aria-label="Mobile">
      <a href="/">Home</a>
        
        <a href="/tinker/">Tinker</a>
        
      <a href="/blog/">Blog</a>
      <a href="/#join-us">Join us</a>
    </nav>
  </div>
  
  
</header>



    
<main id="main" class="post">
  
  
  
  
  
  
  
  <div class="post-heading">
    <h1 class="post-title">Modular Manifolds</h1>
    
    <div class="publish-metadata">
      
      
      <span class="author">
        
        <a href="https://jeremybernste.in/" rel="me noopener" target="_blank">Jeremy Bernstein</a>
        
      </span>
      

      
      <span>
        Sep 26, 2025
      </span>

      

      

      
    </div>
  </div>

  

  
  <div class="post-cover">
    
      
      
      <svg xmlns="http://www.w3.org/2000/svg" width="1732" height="824" fill="none" viewBox="0 0 1732 824"><path fill="#f5f5f5" d="M0 0h1732v824H0z"/><path fill="#fff" d="M0 0h1732v824H0z"/><text xml:space="preserve" fill="url(#paint0_linear_0_1-mm-cube-cover-svg)" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'DejaVu Sans Mono', monospace" font-size="16" font-weight="500" letter-spacing="0em" style="white-space:pre; font-variant-numeric: tabular-nums; font-feature-settings: 'tnum' 1; font-kerning: none; text-rendering:geometricPrecision"><tspan x="300.109" y="123.188">77
</tspan><tspan x="280.328" y="142.188">777777
</tspan><tspan x="250.656" y="161.188">777777777777                   </tspan><tspan x="220.984" y="180.188">777777777777777777                </tspan><tspan x="186.367" y="199.188">7777777777777777777777777            </tspan><tspan x="161.641" y="218.188">777777777777777777777777777777          </tspan><tspan x="122.078" y="237.188">77777777777777777777777777777777777777      </tspan><tspan x="92.406" y="256.188">77777777777777777777777777777777777777777777   </tspan><tspan x="72.625" y="275.188">177777777777777777777777777777777777777777777772 </tspan><tspan x="72.625" y="294.188">445377777777777777777777777777777777777777775800 </tspan><tspan x="72.625" y="313.188">444445377777777777777777777777777777777715000000 </tspan><tspan x="72.625" y="332.188">444444445277777777777777777777777777716800000000 </tspan><tspan x="72.625" y="351.188">444444444444217777777777777777777736000000000000 </tspan><tspan x="72.625" y="370.188">444444444444444517777777777777739000000000000000 </tspan><tspan x="72.625" y="389.188">444444444444444444517777777728000000000000000000 </tspan><tspan x="72.625" y="408.188">444444444444444444444537748000000000000000000000 </tspan><tspan x="72.625" y="427.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="72.625" y="446.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="72.625" y="465.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="72.625" y="484.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="72.625" y="503.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="72.625" y="522.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="72.625" y="541.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="72.625" y="560.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="92.406" y="579.188">44444444444444444444460000000000000000000000   </tspan><tspan x="122.078" y="598.188">44444444444444444460000000000000000000      </tspan><tspan x="161.641" y="617.188">444444444444446000000000000000          </tspan><tspan x="181.422" y="636.188">44444444444460000000000000
</tspan><tspan x="62.734" y="655.188">              44444444446000000000
</tspan><tspan x="62.734" y="674.188">                   444446000000
</tspan><tspan x="280.328" y="693.188">446800
</tspan><tspan x="300.109" y="712.188">40</tspan></text><text xml:space="preserve" fill="#fff" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'DejaVu Sans Mono', monospace" font-size="16" font-weight="500" letter-spacing="0em" style="white-space:pre; font-variant-numeric: tabular-nums; font-feature-settings: 'tnum' 1; font-kerning: none; text-rendering:geometricPrecision"><tspan x="141.859" y="636.188">4444</tspan></text><text xml:space="preserve" fill="#0155bf" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'DejaVu Sans Mono', monospace" font-size="16" font-weight="500" letter-spacing="0em" style="white-space:pre; font-variant-numeric: tabular-nums; font-feature-settings: 'tnum' 1; font-kerning: none; text-rendering:geometricPrecision"><tspan x="856.109" y="123.188">77
</tspan><tspan x="836.328" y="142.188">777777
</tspan><tspan x="806.656" y="161.188">777777777777                   </tspan><tspan x="776.984" y="180.188">777777777777777777                </tspan><tspan x="742.367" y="199.188">7777777777777777777777777            </tspan><tspan x="717.641" y="218.188">777777777777777777777777777777          </tspan><tspan x="678.078" y="237.188">77777777777777777777777777777777777777      </tspan><tspan x="648.406" y="256.188">77777777777777777777777777777777777777777777   </tspan><tspan x="628.625" y="275.188">177777777777777777777777777777777777777777777772 </tspan><tspan x="628.625" y="294.188">445377777777777777777777777777777777777777775800 </tspan><tspan x="628.625" y="313.188">444445377777777777777777777777777777777715000000 </tspan><tspan x="628.625" y="332.188">444444445277777777777777777777777777716800000000 </tspan><tspan x="628.625" y="351.188">444444444444217777777777777777777736000000000000 </tspan><tspan x="628.625" y="370.188">444444444444444517777777777777739000000000000000 </tspan><tspan x="628.625" y="389.188">444444444444444444517777777728000000000000000000 </tspan><tspan x="628.625" y="408.188">444444444444444444444537748000000000000000000000 </tspan><tspan x="628.625" y="427.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="628.625" y="446.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="628.625" y="465.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="628.625" y="484.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="628.625" y="503.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="628.625" y="522.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="628.625" y="541.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="628.625" y="560.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="648.406" y="579.188">44444444444444444444460000000000000000000000   </tspan><tspan x="678.078" y="598.188">44444444444444444460000000000000000000      </tspan><tspan x="717.641" y="617.188">444444444444446000000000000000          </tspan><tspan x="737.422" y="636.188">44444444444460000000000000
</tspan><tspan x="618.734" y="655.188">              44444444446000000000
</tspan><tspan x="618.734" y="674.188">                   444446000000
</tspan><tspan x="836.328" y="693.188">446800
</tspan><tspan x="856.109" y="712.188">40</tspan></text><text xml:space="preserve" fill="#fff" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'DejaVu Sans Mono', monospace" font-size="16" font-weight="500" letter-spacing="0em" style="white-space:pre; font-variant-numeric: tabular-nums; font-feature-settings: 'tnum' 1; font-kerning: none; text-rendering:geometricPrecision"><tspan x="697.859" y="636.188">4444</tspan></text><text xml:space="preserve" fill="#21b3ff" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'DejaVu Sans Mono', monospace" font-size="16" font-weight="500" letter-spacing="0em" style="white-space:pre; font-variant-numeric: tabular-nums; font-feature-settings: 'tnum' 1; font-kerning: none; text-rendering:geometricPrecision"><tspan x="1412.11" y="123.188">77
</tspan><tspan x="1392.33" y="142.188">777777
</tspan><tspan x="1362.66" y="161.188">777777777777                   </tspan><tspan x="1332.98" y="180.188">777777777777777777                </tspan><tspan x="1298.37" y="199.188">7777777777777777777777777            </tspan><tspan x="1273.64" y="218.188">777777777777777777777777777777          </tspan><tspan x="1234.08" y="237.188">77777777777777777777777777777777777777      </tspan><tspan x="1204.41" y="256.188">77777777777777777777777777777777777777777777   </tspan><tspan x="1184.62" y="275.188">177777777777777777777777777777777777777777777772 </tspan><tspan x="1184.62" y="294.188">445377777777777777777777777777777777777777775800 </tspan><tspan x="1184.62" y="313.188">444445377777777777777777777777777777777715000000 </tspan><tspan x="1184.62" y="332.188">444444445277777777777777777777777777716800000000 </tspan><tspan x="1184.62" y="351.188">444444444444217777777777777777777736000000000000 </tspan><tspan x="1184.62" y="370.188">444444444444444517777777777777739000000000000000 </tspan><tspan x="1184.62" y="389.188">444444444444444444517777777728000000000000000000 </tspan><tspan x="1184.62" y="408.188">444444444444444444444537748000000000000000000000 </tspan><tspan x="1184.62" y="427.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="1184.62" y="446.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="1184.62" y="465.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="1184.62" y="484.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="1184.62" y="503.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="1184.62" y="522.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="1184.62" y="541.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="1184.62" y="560.188">444444444444444444444446000000000000000000000000 </tspan><tspan x="1204.41" y="579.188">44444444444444444444460000000000000000000000   </tspan><tspan x="1234.08" y="598.188">44444444444444444460000000000000000000      </tspan><tspan x="1273.64" y="617.188">444444444444446000000000000000          </tspan><tspan x="1293.42" y="636.188">44444444444460000000000000
</tspan><tspan x="1174.73" y="655.188">              44444444446000000000
</tspan><tspan x="1174.73" y="674.188">                   444446000000
</tspan><tspan x="1392.33" y="693.188">446800
</tspan><tspan x="1412.11" y="712.188">40</tspan></text><text xml:space="preserve" fill="#fff" font-family="ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'DejaVu Sans Mono', monospace" font-size="16" font-weight="500" letter-spacing="0em" style="white-space:pre; font-variant-numeric: tabular-nums; font-feature-settings: 'tnum' 1; font-kerning: none; text-rendering:geometricPrecision"><tspan x="1253.86" y="636.188">4444</tspan></text><defs><linearGradient id="paint0_linear_0_1-mm-cube-cover-svg" x1="310" x2="310" y1="704.129" y2="112.129" gradientUnits="userSpaceOnUse"><stop stop-color="#0e9972"/><stop offset=".481" stop-color="#0e9972"/><stop offset="1" stop-color="#0e9972"/></linearGradient></defs></svg>

    
  </div>
  

  

  <article class="content ">
    
    <nav id="left-toc" class="left-toc" aria-label="Table of contents"></nav>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<p>When we train large neural networks, we need to keep them healthy. We do not want the tensors in the network&mdash;either the weights, activations or gradients&mdash;to grow too large or too small. Very small and very large tensors cause a variety of problems not just limited to numerical underflow and overflow. For example, weight matrices changing size during training makes it harder to design training algorithms&mdash;since the relative size of updates to weights has a significant impact on the speed of learning.</p>
<p>The gold standard for keeping tensors healthy is to normalize them. Normalization is commonplace for activation vectors, where we use techniques like <a href="https://arxiv.org/abs/1607.06450">layer norm</a> to put the activations on a good scale before passing them to the next layer. It is also commonplace to normalize gradient updates, where we can interpret fast training algorithms like the <a href="https://kellerjordan.github.io/posts/muon/">Muon optimizer</a> as spectrally normalizing the updates. Normalization provides us with certainty about the sizes of tensors&mdash;without needing to check Wandb!&mdash;and when training large neural networks with many interacting components, having certainty about the network internals is valuable.</p>
<p>Normalization is less commonly applied to weight matrices, although it is not unheard of. For example, the <a href="https://github.com/NVlabs/edm2">EDM2</a> diffusion model codebase uses weight constraints and the authors report benefits in <a href="https://arxiv.org/abs/2312.02696">their paper</a>. And <a href="https://arxiv.org/abs/1912.11370">BiT</a> uses <a href="https://arxiv.org/abs/1903.10520">weight standardization</a>. Various other techniques have been proposed but are not common practice in modern large-scale training.<label for="sn1" class="sidenote-number"></label><input type="checkbox" id="sn1" class="margin-toggle"/><span class="sidenote">For some more examples, see <a href="https://arxiv.org/abs/1602.07868">Salimans et al, 2016</a>, <a href="https://arxiv.org/abs/1802.05957">Miyato et al, 2018</a> and our paper <a href="https://arxiv.org/abs/2102.07227">Liu et al, 2021</a>.</span> Normalizing the weight matrices might be a good idea for a few reasons. Weight constraints make understanding the relative size of optimization updates easier. They remove the problem of weight norms exploding. They allow us to focus hyperparameter tuning effort on tensors whose size matters most. They can force matrices to have a small <a href="https://en.wikipedia.org/wiki/Condition_number">condition number</a>, making their behaviour more predictable. And relatedly, weight constraints facilitate <a href="https://theses.hal.science/tel-04674274v1">Lipschitz guarantees</a> for robustness to perturbations.</p>
<p>This post covers one appealing way to constrain the weight matrices of a neural network&mdash;by keeping the tensors constrained to submanifolds at each layer. This opens the door to re-thinking optimization, as we can co-design optimization algorithms with these manifold constraints. As an example, we propose<label for="sna" class="sidenote-number"></label><input type="checkbox" id="sna" class="margin-toggle"/><span class="sidenote">This algorithm builds on work from Jianlin Su and Franz Louis Cesista, as discussed further below.</span> a manifold version of the Muon optimizer whose weights are constrained to the Stiefel manifold: the manifold of matrices with unit <a href="https://en.wikipedia.org/wiki/Condition_number">condition number</a>. We conclude the post by defining the idea of a <em>modular manifold</em>, which is a composable manifold that attempts to make it easier to scale up and train large networks.</p>
<p>Our goal in writing this post is to provide an introduction to a research area that we are excited about, and highlight many directions for future work. We would love to see more work from the community on the topics mentioned at the end of the post!</p>
<h2 id="the-shape-of-a-manifold-optimizer">The shape of a manifold optimizer</h2>
<p>This section works through the simplest example of learning on a manifold: a vector parameter constrained to a hypersphere in $\mathbb{R}^d$. The vector parameter is trained to minimize a loss function defined over the full space $\mathbb{R}^d$. This setup might be useful for, say, individual embedding vectors in a transformer model. This section will be a good warmup for the following section on <a href="#muon-on-the-stiefel-manifold">manifold Muon</a> that considers matrix parameters.</p>
<p>We will not be too formal about the definition of a manifold here: it is enough to understand that a manifold is a curved surface that looks flat when you zoom in close enough. The locally flat approximation at a point on the manifold is called the <em>tangent space</em> to the manifold, as visualized in <a href="#fig:tangent-space">Figure <span data-ref="tangent-space"></span></a>:</p>
<figure id="fig:tangent-space">
<canvas id="canvas-tangent-space"></canvas>
<script src="js/tangent.js"></script>
<figcaption>The sphere in three dimensions—or the hypersphere in higher dimensions—is a manifold. The locally flat approximation at a point on the manifold is called the tangent space to the manifold and is visualized as the red plane in the figure.</figcaption>
</figure>
<p>We can characterize the hypersphere in $d$ dimensions as the set of points $w \in \mathbb{R}^d$ of unit Euclidean norm. And the tangent space at a point $w$ on the hypersphere is the set of all vectors $a \in \mathbb{R}^d$ that are orthogonal to $w$.</p>
<p>To keep the weights constrained to the manifold, we could use a non-manifold optimizer and just project the weights back to the manifold after each step. Instead, we are interested in designing methods that take steps in the tangent space. The reason is that we would like to be able to equate the learning rate of our optimizer with the actual length of the optimization step. But if the optimization steps are pointing significantly off manifold and then being projected back, this nice property does not hold. Similar motivation is given in Section 2.3 of the <a href="https://arxiv.org/abs/2312.02696">EDM2 paper</a>.</p>
<p>Before we can design a training algorithm for this manifold, something important we need to decide on is how to measure distance<label for="sn3" class="sidenote-number"></label><input type="checkbox" id="sn3" class="margin-toggle"/><span class="sidenote">For a manifold to be &ldquo;Riemannian&rdquo;, the distance measure must be induced by an inner product. The <a href="https://en.wikipedia.org/wiki/Euclidean_distance">Euclidean ($\ell_2$) norm</a> is induced by an inner product, but the <a href="https://en.wikipedia.org/wiki/Taxicab_geometry">Manhattan ($\ell_1$) distance</a> is not.</span> in the tangent space. A common choice is the Euclidean distance, but we could also choose to measure distance in other ways, as visualized in <a href="#fig:inscribed-norm-balls">Figure <span data-ref="inscribed-norm-balls"></span></a>. In the next section, we will talk about choosing a distance measure based on the functionality of the module.</p>
<figure id="fig:inscribed-norm-balls">
<canvas id="canvas-inscribed-norm-ball"></canvas>
<script src="js/inscribed-norm-ball.js"></script>
<figcaption>Inscribing unit balls in the tangent space for different distance measures. The $\ell_2$ (Euclidean) unit ball is a circle while the $\ell_1$ (Manhattan) unit ball is a diamond.</figcaption>
</figure>
<p>Crucially, the choice of distance measure changes the direction of the best optimization step. If the distance measure is non-Euclidean, then for a fixed length step, we may be able to move further in the direction of the gradient<label for="sn4" class="sidenote-number"></label><input type="checkbox" id="sn4" class="margin-toggle"/><span class="sidenote">By gradient, we mean the partial derivative of the loss with respect to the weights. Mathematicians reserve the term gradient for <a href="https://en.wikipedia.org/wiki/Gradient#Riemannian_manifolds">something else</a> in Riemannian geometry.</span> by not following the gradient direction exactly! This concept is visualized in <a href="#fig:tangent-space-with-gradient">Figure <span data-ref="tangent-space-with-gradient"></span></a>.</p>
<figure id="fig:tangent-space-with-gradient">
<canvas id="canvas-tangent-with-gradient"></canvas>
<script src="js/tangent-with-gradient.js"></script>
<figcaption>How geometry influences the direction of the best optimization step. The pink arrow represents the raw gradient—meaning the partial derivative of the loss with respect to the weights. The yellow diamond denotes the $\ell_1$ unit ball. The green arrow is the unit vector pointing furthest in the direction of the gradient. Notice how the green arrow is not parallel to the pink arrow. (In practice, the pink arrow need not lie in the tangent space, although the green arrow will do by construction.) Try dragging the pink arrow to see how the best update direction changes.</figcaption>
</figure>
<p>To see how this works out in math, we can formulate the optimal update direction given a manifold constraint and a distance measure as itself solving a constrained optimization problem. We will demonstrate this for the case of the hypersphere equipped with the Euclidean norm. Letting $g$ denote the gradient, $w$ the current point on the hypersphere, $a$ the update direction and $\eta$ the learning rate, we need to solve:</p>
$$\min_{a\in\mathbb{R}^d} \quad \underbrace{a^\top g\vphantom{\|a\|_2 = 1}}_{\mathclap{\text{linear change in loss}}} \quad \text{such that} \quad  \underbrace{\|a\|_2 = \eta}_{\mathclap{\text{size constraint}}} \quad \text{and} \quad \underbrace{a^\top w = 0\vphantom{\|a\|_2 = 1}}_{\mathclap{\text{tangent constraint}}}.\tag{$\star$}$$<p>Mapping back to the visual language of Figures <a href="#fig:tangent-space"><span data-ref="tangent-space"></span></a>, <a href="#fig:inscribed-norm-balls"><span data-ref="inscribed-norm-balls"></span></a> and <a href="#fig:tangent-space-with-gradient"><span data-ref="tangent-space-with-gradient"></span></a>, this formula says that the green arrow (optimal value of $a$) must belong to the red tangent hyperplane ($a^\top w = 0$) and must also lie on a yellow circle of radius $\eta$ ($\|a\|_2 = \eta$). To solve $(\star)$, we can apply the <a href="https://en.wikipedia.org/wiki/Lagrange_multiplier">method of Lagrange multipliers</a>. The relevant Lagrangian function is given by:</p>
$$\mathcal{L}(a, \lambda, \mu) = a^\top g + \frac{\lambda}{2} \cdot (a^\top a - \eta) + \mu \cdot (a^\top w),$$<p>
where $\lambda$ and $\mu$ are Lagrange multipliers. Setting the derivative of the Lagrangian with respect to $a$ to zero and applying the constraints to solve for $\lambda$ and $\mu$, the optimal update $a_\mathrm{opt}$ ends up being given by the following formula:
</p>
$$a_\mathrm{opt} = - \eta \times \frac{g - ww^\top g}{\|g-ww^\top g\|_2}.$$<p>In words, the optimal update is given by subtracting out the radial component from the gradient, normalizing and multiplying by the learning rate. Since this update lies in the tangent space, actually a very small<label for="sn5" class="sidenote-number"></label><input type="checkbox" id="sn5" class="margin-toggle"/><span class="sidenote">For a learning rate $\eta$, the effect of the retraction map is $\mathcal{O}(\eta^2)$ small, so the learning rate <em>almost</em> equals the length of the step.</span> correction is needed to stay on the manifold. The correction is known as a &ldquo;retraction map&rdquo; and is visualized in <a href="#fig:retraction-map">Figure <span data-ref="retraction-map"></span></a>:</p>
<figure id="fig:retraction-map">
<canvas id="canvas-retraction-map-2d"></canvas>
<script src="js/retraction-map-2d.js"></script>
<figcaption>Visualizing the retraction map. The green arrow is the update taken in the tangent space. Since for large step sizes the tangent space starts to diverge from the manifold, we need to project the updated weights back to the manifold using the retraction map—illustrated by the purple arrow.</figcaption>
</figure>
<p>We can solve for the retraction map by applying Pythagoras&rsquo; theorem to <a href="#fig:retraction-map">Figure <span data-ref="retraction-map"></span></a>. For a unit hypersphere and a step of length $\eta$, the hypotenuse has length $\sqrt{1+\eta^2}$ and therefore the retraction map for the hypersphere equipped with the Euclidean norm is simply given by dividing the updated weights through by $\sqrt{1+\eta^2}$. Putting everything together, the full manifold optimization algorithm is then given by:</p>
$$w \gets \frac{1}{\sqrt{1+\eta^2}} \left[w - \eta \times \frac{g - ww^\top g}{\|g-ww^\top g\|_2}\right].$$<p>As an exercise for the reader: try calculating the Euclidean norm of the updated weight vector and check that the updated weight vector indeed lies on the hypersphere.</p>
<p>To summarize this section, a first-order manifold optimizer has three steps:</p>
<ol>
<li>Find the tangent vector of unit length that goes furthest in the gradient direction.</li>
<li>Multiply this direction by the learning rate and subtract from the weights;</li>
<li>Retract the updated weights back to the manifold.</li>
</ol>
<p>There are two decisions to make in applying this procedure: what manifold constraint we should use and how we should measure length. By making different decisions, we can generate different optimization algorithms as shown in the following table.</p>
<table>
  <thead>
      <tr>
          <th>Manifold</th>
          <th>Norm</th>
          <th>Optimizer</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Euclidean $\mathbb{R}^n$</td>
          <td>Euclidean norm</td>
          <td>vanilla gradient descent</td>
      </tr>
      <tr>
          <td>Euclidean $\mathbb{R}^n$</td>
          <td>infinity norm</td>
          <td>sign gradient descent</td>
      </tr>
      <tr>
          <td>hypersphere $S^n$</td>
          <td>Euclidean norm</td>
          <td>hyperspherical descent</td>
      </tr>
      <tr>
          <td>matrix space $\mathbb{R}^{m\times n}$</td>
          <td>spectral norm</td>
          <td>Muon</td>
      </tr>
      <tr>
          <td>Stiefel manifold $\subset\mathbb{R}^{m\times n}$</td>
          <td>spectral norm</td>
          <td>manifold Muon</td>
      </tr>
  </tbody>
</table>
<p>We will derive the final algorithm in the table, manifold Muon, in the next section. To design a manifold constraint and a distance function for a matrix parameter, we shall think carefully about the role that a weight matrix plays inside a neural network.</p>
<h2 id="manifold-muon">Manifold Muon</h2>
<p>A typical weight matrix $W$ in a transformer is a &ldquo;vector-multiplier&rdquo;, meaning that it transforms an input vector $x$ into an output vector $y = Wx$. We will design a manifold constraint and a distance function so that the matrix acts in a good way on input vectors: the matrix should not produce excessively small or large outputs, and updates to the matrix should not cause the output vector to change too much or too little.</p>
<p>A good way to think about how a matrix acts on vectors is through the <a href="https://en.wikipedia.org/wiki/Singular_value_decomposition">singular value decomposition</a>, illustrated in <a href="#fig:svd">Figure <span data-ref="svd"></span></a>. The SVD decomposes a matrix in a way that tells us how the matrix stretches input vectors along different axes.</p>
<figure id="fig:svd">
<svg xmlns="http://www.w3.org/2000/svg" width="735" height="272" fill="none" viewBox="0 0 735 272"><path fill="#f5f5f5" d="M0 0h735v272H0z"/><path fill="#fff" d="M0 0h735v272H0z"/><text xml:space="preserve" fill="#2a2a2a" font-family="Iowan Old Style BT" font-size="16" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="105.406" y="212.208">m</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="GT America Trial" font-size="16" letter-spacing="0em" style="white-space:pre"><tspan x="124.219" y="211.936">x</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="Iowan Old Style BT" font-size="16" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="139.289" y="212.208">n</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="Iowan Old Style BT" font-size="16" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="292.406" y="212.208">m</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="GT America Trial" font-size="16" letter-spacing="0em" style="white-space:pre"><tspan x="311.219" y="211.936">x</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="Iowan Old Style BT" font-size="16" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="326.422" y="212.208">k</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="Iowan Old Style BT" font-size="16" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="430.422" y="212.208">k</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="GT America Trial" font-size="16" letter-spacing="0em" style="white-space:pre"><tspan x="445.219" y="211.936">x</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="Iowan Old Style BT" font-size="16" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="460.422" y="212.208">k</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="Iowan Old Style BT" font-size="16" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="412.445" y="234.208">k </tspan><tspan x="433.398" y="234.208"> rank M</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="GT America Trial" font-size="16" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="424.242" y="234.208">=</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="Iowan Old Style BT" font-size="16" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="586.422" y="212.208">k</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="GT America Trial" font-size="16" letter-spacing="0em" style="white-space:pre"><tspan x="601.219" y="211.936">x</tspan></text><text xml:space="preserve" fill="#2a2a2a" font-family="Iowan Old Style BT" font-size="16" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="616.289" y="212.208">n</tspan></text><text xml:space="preserve" fill="#000" font-family="Iowan Old Style BT" font-size="24" letter-spacing="0em" style="white-space:pre"><tspan x="217.004" y="127.312">=</tspan></text><path fill="#fff" stroke="#2a2a2a" stroke-width="3" d="M52.5 60.5h147v117h-147z"/><path fill="#fff" d="M75 58h102v122H75z"/><path fill="#fff" d="M107 102h38v34h-38z"/><text xml:space="preserve" fill="#2a2a2a" font-family="Iowan Old Style BT" font-size="24" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="115.289" y="126.812">M</tspan></text><path fill="#fff" stroke="#2a2a2a" stroke-width="3" d="M254.5 60.5h117v117h-117z"/><path fill="#fff" d="M277 58h72v122h-72z"/><path stroke="#ef402c" stroke-width="3" d="M314 59v120"/><path fill="#fff" d="M294 100h38v38h-38z"/><text xml:space="preserve" fill="#ef402c" font-family="Iowan Old Style BT" font-size="24" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="304.129" y="126.812">U</tspan></text><path fill="#fff" stroke="#2a2a2a" stroke-width="3" d="M390.5 60.5h117v91h-117z"/><path fill="#fff" d="M413 58h72v96h-72z"/><path stroke="#00a7ff" stroke-width="3" d="M396 65.5 500 145"/><path fill="#fff" d="M432 91h34v30h-34z"/><text xml:space="preserve" fill="#00a7ff" font-family="New York" font-size="24" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="439.629" y="114.031">Σ</tspan></text><path fill="#fff" stroke="#2a2a2a" stroke-width="3" d="M526.5 60.5h157v91h-157z"/><path fill="#fff" d="M549 58h112v96H549z"/><path stroke="#169e78" stroke-width="3" d="M533 106h144"/><path fill="#fff" d="M586 89h38v34h-38z"/><text xml:space="preserve" fill="#169e78" font-family="Iowan Old Style BT" font-size="24" font-style="italic" letter-spacing="0em" style="white-space:pre"><tspan x="596.938" y="113.812">V</tspan></text><text xml:space="preserve" fill="#169e78" font-family="GT America Mono Trial" font-size="12" font-weight="500" letter-spacing="0em" style="white-space:pre"><tspan x="615.279" y="99.952">T</tspan></text><path fill="#fff" d="m428 95.3 4.573-5.299 5.3 4.573-4.573 5.3z"/><path fill="#fff" d="m459 118.301 4.573-5.3 5.3 4.573-4.573 5.3z"/></svg>
<figcaption>The singular value decomposition. A matrix $M\in\mathbb{R}^{m\times n}$ of rank $k$ can always be decomposed as $M = U \Sigma V^\top$, where $U\in\mathbb{R}^{m\times k}$ and $V\in\mathbb{R}^{n\times k}$ have orthonormal columns and $\Sigma\in\mathbb{R}^{k\times k}$ is a diagonal matrix with only positive entries. The entries of $\Sigma$ are called the singular values of $M$. The singular values measure the stretching effect that the matrix has on vectors that align with the corresponding columns of $U$ and $V$.</figcaption>
</figure>
<p>We would like the matrix to have a stretching effect close to one, so we will choose a matrix manifold where all the singular values are exactly one. This matrix manifold is known formally as the <a href="https://en.wikipedia.org/wiki/Stiefel_manifold"><em>Stiefel manifold</em></a>. We can assume without loss of generality that we are dealing with a tall matrix ($m \geq n$), and then the Stiefel manifold can be equivalently defined as the following set:</p>
$$\mathsf{Stiefel}(m,n) := \left\{ W \in \mathbb{R}^{m \times n} \mid W^T W = I_n \right\}.$$<p>Furthermore, <a href="https://cseweb.ucsd.edu/classes/sp24/cse291-e/papers/StiefelManifold/StiefelNotes.pdf">one may show</a> that a matrix $A \in \mathbb{R}^{m \times n}$ lies tangent<label for="sn-stiefel-tangent" class="sidenote-number"></label><input type="checkbox" id="sn-stiefel-tangent" class="margin-toggle"/><span class="sidenote">Notice that the Stiefel constraint $W^T W = I_n$ directly generalizes the hyperspherical constraint $w^\top w = 1$ from the previous section. Similarly, the tangent space condition generalizes the hyperspherical one that $a^\top w = 0$.</span> to the Stiefel manifold at matrix $W$ if and only if:</p>
$$A^\top W + W^\top A = 0.$$<p>To design a manifold optimizer for the Stiefel manifold, all that remains is to choose a distance function. To limit the maximum stretching effect the weight update can have on an input vector, we will choose the <em>spectral norm</em>, which measures the largest singular value of a matrix. Although this only limits the maximum effect the update can have, since the optimizer we derive will saturate this bound, it will turn out to prevent the minimum effect of the update from being too small.<label for="sn-stiefel-spectral-norm" class="sidenote-number"></label><input type="checkbox" id="sn-stiefel-spectral-norm" class="margin-toggle"/><span class="sidenote">There are some exceptions to this statement, such as when a weight matrix has a fan-out less than its fan-in, in which case we cannot escape from the matrix and its updates having a null space and mapping some inputs to zero.</span></p>
<p>The idea of doing gradient descent under a spectral norm constraint is what <a href="https://jeremybernste.in/writing/deriving-muon">led to</a> the Muon optimizer and, when combined with the Stiefel manifold constraint, we obtain a problem that we shall call <em>manifold Muon</em>:</p>
$$\min_{A\in\mathbb{R}^{m\times n}} \quad \underbrace{\operatorname{trace}(G^T A)}_{\mathclap{\text{linear change in loss}}} \quad \text{such that} \quad \underbrace{\|A\|_{\text{spectral}} \leq \eta}_{\mathclap{\text{size constraint}}} \quad \text{and} \quad \underbrace{A^T W + W^T A = 0\vphantom{\|A\|_{\text{spectral}} = \eta}}_{\mathclap{\text{tangent constraint}}} \tag{$\dagger$}.$$<p>The manifold Muon problem $(\dagger)$ directly generalizes problem $(\star)$ from the previous section. Solving $(\dagger)$ is harder than solving $(\star)$, and here we will present a numerical solution inspired<label for="sn6" class="sidenote-number"></label><input type="checkbox" id="sn6" class="margin-toggle"/><span class="sidenote">I <a href="https://docs.modula.systems/algorithms/manifold/orthogonal/">figured out</a> how to solve manifold Muon in the square case late last year, but I was unable to solve the full rectangular case and thus <a href="https://docs.modula.systems/algorithms/manifold/orthogonal/#open-problem-extending-to-the-stiefel-manifold">posed the problem</a> as an open problem on the Modula docs. Jianlin Su <a href="https://kexue.fm/archives/11221">solved the problem</a> this summer by taking a Lagrangian approach and working out a fixed point iteration on the optimality condition. I saw an early version of Jianlin&rsquo;s work (which did not quite work yet) and also <a href="https://leloykun.github.io/ponder/steepest-descent-stiefel/">related work</a> by Franz Louis Cesista, and I was able to work out the dual ascent algorithm presented here.</span> by work done by Jianlin Su and Franz Louis Cesista.</p>
<p>Our key insight is that $(\dagger)$ is a convex optimization problem that may be solved via a standard method known as <a href="https://www.cs.cmu.edu/~pradeepr/convexopt/Lecture_Slides/dual-ascent.pdf"><em>dual ascent</em></a>. Here we will just sketch the main idea, but you can find a more detailed derivation <a href="https://docs.modula.systems/algorithms/manifold/stiefel/">on this page</a>.</p>
<p>Similar to Jianlin&rsquo;s approach, we introduce a matrix of Lagrange multipliers $\Lambda\in\mathbb{R}^{n\times n}$. We then apply a series of transformations to convert the problem $(\dagger)$ from a <em>constrained minimization problem</em> to an <em>unconstrained maximization problem</em>:</p>
$$
\begin{align}
(\dagger) &= \min_{\|A\|_\mathrm{spectral} \leq \eta} \max_{\Lambda} \;\operatorname{trace} G^\top A + \operatorname{trace}\Lambda^\top (A^\top W + W^\top A) \\
&= \min_{\|A\|_\mathrm{spectral} \leq \eta} \max_{\Lambda}\; \operatorname{trace}A^\top (G + 2W(\Lambda+\Lambda^\top))\\
&= \max_{\Lambda} \min_{\|A\|_\mathrm{spectral} \leq \eta} \; \operatorname{trace}A^\top (G + 2W(\Lambda+\Lambda^\top))\\
&= \max_{\Lambda} \; - \eta \times \|G + 2W(\Lambda+\Lambda^\top)\|_\mathrm{nuclear}.
\end{align}
$$<p>Equation (1) reformulates the problem as a <a href="https://www-cs.stanford.edu/people/davidknowles/lagrangian_duality.pdf">saddle point problem</a>: the maximization over $\Lambda$ will send the objective to infinity whenever the tangent space condition is violated. Equation (2) follows by applying properties of the trace and equation (3) follows from Sion&rsquo;s minimax theorem. The inner minimization in equation (3) is solved by setting $A_\mathrm{opt}(\Lambda) = - \eta \times \operatorname{msign}(G + 2W(\Lambda+\Lambda^\top))$ where $\operatorname{msign}$ is the <a href="https://docs.modula.systems/algorithms/newton-schulz/">matrix sign function</a>.<label for="sn7" class="sidenote-number"></label><input type="checkbox" id="sn7" class="margin-toggle"/><span class="sidenote">The matrix sign function snaps the singular values of a matrix to one. It may be computed efficiently on GPUs via Newton-Schulz iteration or the recent <a href="https://arxiv.org/abs/2505.16932">Polar Express</a> algorithm.</span> And we obtain equation (4) by substituting this expression for $A_\mathrm{opt}(\Lambda)$ into equation (3). Equation (4) is known as the &ldquo;dual problem&rdquo; to $(\dagger)$ and we can solve it by gradient ascent. After some work, the gradient of the dual function is given by:</p>
$$
\begin{align}
H(\Lambda) &:= - \eta \times \nabla_\Lambda \|G + W (\Lambda+\Lambda^\top)\|_\mathrm{nuclear} \\
&= - \eta \times [W^\top\mathrm{msign}(G + 2W (\Lambda+\Lambda^\top)) + \operatorname{msign}(G + 2W (\Lambda+\Lambda^\top))^\top W],
\end{align}
$$<p>where the nuclear norm $\|\cdot\|_\mathrm{nuclear}$ measures the sum of the singular values of a matrix.</p>
<p>Finally, we can write down the manifold Muon algorithm:<label for="sn8" class="sidenote-number"></label><input type="checkbox" id="sn8" class="margin-toggle"/><span class="sidenote">Note that this algorithm is closely related to <a href="https://kexue.fm/archives/11221">Jianlin Su&rsquo;s solution</a>. Where we run dual ascent, Jianlin&rsquo;s solution amounts to solving for the maximum of the dual function $H(\Lambda)=0$ via a fixed point iteration.</span></p>
<ol>
<li>Run gradient ascent on the dual variable $\Lambda \gets \Lambda + \alpha \times H(\Lambda)$ to solve for $\Lambda_\mathrm{opt}$.</li>
<li>Compute the update $A_\mathrm{opt} = - \eta \times \operatorname{msign}(G + 2W(\Lambda_{\mathrm{opt}}+\Lambda_\mathrm{opt}^\top))$.</li>
<li>Apply the update to the weights $W \gets W + A_\mathrm{opt}$.</li>
<li>Retract the weights back to the manifold $W \gets \operatorname{msign}(W)$.</li>
</ol>
<p>We ran a very small experiment to sanity check the algorithm and provide a minimal implementation for students or researchers to play with. Each training run finishes in less than a minute. The code is <a href="https://github.com/thinking-machines-lab/manifolds/">here</a> and see <a href="#fig:cifar10">Figure <span data-ref="cifar10"></span></a> for the setup and results.</p>
<figure id="fig:cifar10">
<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
  "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns:xlink="http://www.w3.org/1999/xlink" width="720pt" height="252pt" viewBox="0 0 720 252" xmlns="http://www.w3.org/2000/svg" version="1.1">
 <metadata>
  <rdf:RDF xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
   <cc:Work>
    <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/>
    <dc:date>2025-09-25T11:22:41.551982</dc:date>
    <dc:format>image/svg+xml</dc:format>
    <dc:creator>
     <cc:Agent>
      <dc:title>Matplotlib v3.10.5, https://matplotlib.org/</dc:title>
     </cc:Agent>
    </dc:creator>
   </cc:Work>
  </rdf:RDF>
 </metadata>
 <defs>
  <style type="text/css">*{stroke-linejoin: round; stroke-linecap: butt}</style>
 </defs>
 <g id="figure_1-cifar10-svg">
  <g id="patch_1-cifar10-svg">
   <path d="M 0 252 
L 720 252 
L 720 0 
L 0 0 
z
" style="fill: #ffffff"/>
  </g>
  <g id="axes_1-cifar10-svg">
   <g id="patch_2-cifar10-svg">
    <path d="M 57.62 196.432 
L 239.760654 196.432 
L 239.760654 31.92 
L 57.62 31.92 
z
" style="fill: #ffffff"/>
   </g>
   <g id="matplotlib.axis_1-cifar10-svg">
    <g id="xtick_1-cifar10-svg">
     <g id="line2d_1-cifar10-svg">
      <defs>
       <path id="me864329786-cifar10-svg" d="M 0 0 
L 0 3.5 
" style="stroke: #000000; stroke-width: 0.8"/>
      </defs>
      <g>
       <use xlink:href="#me864329786-cifar10-svg" x="97.299918" y="196.432" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_1-cifar10-svg">
      <!-- $\mathdefault{10^{-3}}$ -->
      <g transform="translate(80.849918 214.069812) scale(0.14 -0.14)">
       <defs>
        <path id="DejaVuSans-31-cifar10-svg" d="M 794 531 
L 1825 531 
L 1825 4091 
L 703 3866 
L 703 4441 
L 1819 4666 
L 2450 4666 
L 2450 531 
L 3481 531 
L 3481 0 
L 794 0 
L 794 531 
z
" transform="scale(0.015625)"/>
        <path id="DejaVuSans-30-cifar10-svg" d="M 2034 4250 
Q 1547 4250 1301 3770 
Q 1056 3291 1056 2328 
Q 1056 1369 1301 889 
Q 1547 409 2034 409 
Q 2525 409 2770 889 
Q 3016 1369 3016 2328 
Q 3016 3291 2770 3770 
Q 2525 4250 2034 4250 
z
M 2034 4750 
Q 2819 4750 3233 4129 
Q 3647 3509 3647 2328 
Q 3647 1150 3233 529 
Q 2819 -91 2034 -91 
Q 1250 -91 836 529 
Q 422 1150 422 2328 
Q 422 3509 836 4129 
Q 1250 4750 2034 4750 
z
" transform="scale(0.015625)"/>
        <path id="DejaVuSans-2212-cifar10-svg" d="M 678 2272 
L 4684 2272 
L 4684 1741 
L 678 1741 
L 678 2272 
z
" transform="scale(0.015625)"/>
        <path id="DejaVuSans-33-cifar10-svg" d="M 2597 2516 
Q 3050 2419 3304 2112 
Q 3559 1806 3559 1356 
Q 3559 666 3084 287 
Q 2609 -91 1734 -91 
Q 1441 -91 1130 -33 
Q 819 25 488 141 
L 488 750 
Q 750 597 1062 519 
Q 1375 441 1716 441 
Q 2309 441 2620 675 
Q 2931 909 2931 1356 
Q 2931 1769 2642 2001 
Q 2353 2234 1838 2234 
L 1294 2234 
L 1294 2753 
L 1863 2753 
Q 2328 2753 2575 2939 
Q 2822 3125 2822 3475 
Q 2822 3834 2567 4026 
Q 2313 4219 1838 4219 
Q 1578 4219 1281 4162 
Q 984 4106 628 3988 
L 628 4550 
Q 988 4650 1302 4700 
Q 1616 4750 1894 4750 
Q 2613 4750 3031 4423 
Q 3450 4097 3450 3541 
Q 3450 3153 3228 2886 
Q 3006 2619 2597 2516 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-31-cifar10-svg" transform="translate(0 0.765625)"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0.765625)"/>
       <use xlink:href="#DejaVuSans-2212-cifar10-svg" transform="translate(128.203125 39.046875) scale(0.7)"/>
       <use xlink:href="#DejaVuSans-33-cifar10-svg" transform="translate(186.855469 39.046875) scale(0.7)"/>
      </g>
     </g>
    </g>
    <g id="xtick_2-cifar10-svg">
     <g id="line2d_2-cifar10-svg">
      <g>
       <use xlink:href="#me864329786-cifar10-svg" x="166.056527" y="196.432" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_2-cifar10-svg">
      <!-- $\mathdefault{10^{-1}}$ -->
      <g transform="translate(149.606527 214.069812) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-31-cifar10-svg" transform="translate(0 0.684375)"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0.684375)"/>
       <use xlink:href="#DejaVuSans-2212-cifar10-svg" transform="translate(128.203125 38.965625) scale(0.7)"/>
       <use xlink:href="#DejaVuSans-31-cifar10-svg" transform="translate(186.855469 38.965625) scale(0.7)"/>
      </g>
     </g>
    </g>
    <g id="xtick_3-cifar10-svg">
     <g id="line2d_3-cifar10-svg">
      <g>
       <use xlink:href="#me864329786-cifar10-svg" x="234.813135" y="196.432" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_3-cifar10-svg">
      <!-- $\mathdefault{10^{1}}$ -->
      <g transform="translate(222.493135 214.069812) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-31-cifar10-svg" transform="translate(0 0.684375)"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0.684375)"/>
       <use xlink:href="#DejaVuSans-31-cifar10-svg" transform="translate(128.203125 38.965625) scale(0.7)"/>
      </g>
     </g>
    </g>
    <g id="text_4-cifar10-svg">
     <!-- Learning rate -->
     <g transform="translate(101.855952 231.619187) scale(0.14 -0.14)">
      <defs>
       <path id="DejaVuSans-4c-cifar10-svg" d="M 628 4666 
L 1259 4666 
L 1259 531 
L 3531 531 
L 3531 0 
L 628 0 
L 628 4666 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-65-cifar10-svg" d="M 3597 1894 
L 3597 1613 
L 953 1613 
Q 991 1019 1311 708 
Q 1631 397 2203 397 
Q 2534 397 2845 478 
Q 3156 559 3463 722 
L 3463 178 
Q 3153 47 2828 -22 
Q 2503 -91 2169 -91 
Q 1331 -91 842 396 
Q 353 884 353 1716 
Q 353 2575 817 3079 
Q 1281 3584 2069 3584 
Q 2775 3584 3186 3129 
Q 3597 2675 3597 1894 
z
M 3022 2063 
Q 3016 2534 2758 2815 
Q 2500 3097 2075 3097 
Q 1594 3097 1305 2825 
Q 1016 2553 972 2059 
L 3022 2063 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-61-cifar10-svg" d="M 2194 1759 
Q 1497 1759 1228 1600 
Q 959 1441 959 1056 
Q 959 750 1161 570 
Q 1363 391 1709 391 
Q 2188 391 2477 730 
Q 2766 1069 2766 1631 
L 2766 1759 
L 2194 1759 
z
M 3341 1997 
L 3341 0 
L 2766 0 
L 2766 531 
Q 2569 213 2275 61 
Q 1981 -91 1556 -91 
Q 1019 -91 701 211 
Q 384 513 384 1019 
Q 384 1609 779 1909 
Q 1175 2209 1959 2209 
L 2766 2209 
L 2766 2266 
Q 2766 2663 2505 2880 
Q 2244 3097 1772 3097 
Q 1472 3097 1187 3025 
Q 903 2953 641 2809 
L 641 3341 
Q 956 3463 1253 3523 
Q 1550 3584 1831 3584 
Q 2591 3584 2966 3190 
Q 3341 2797 3341 1997 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-72-cifar10-svg" d="M 2631 2963 
Q 2534 3019 2420 3045 
Q 2306 3072 2169 3072 
Q 1681 3072 1420 2755 
Q 1159 2438 1159 1844 
L 1159 0 
L 581 0 
L 581 3500 
L 1159 3500 
L 1159 2956 
Q 1341 3275 1631 3429 
Q 1922 3584 2338 3584 
Q 2397 3584 2469 3576 
Q 2541 3569 2628 3553 
L 2631 2963 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-6e-cifar10-svg" d="M 3513 2113 
L 3513 0 
L 2938 0 
L 2938 2094 
Q 2938 2591 2744 2837 
Q 2550 3084 2163 3084 
Q 1697 3084 1428 2787 
Q 1159 2491 1159 1978 
L 1159 0 
L 581 0 
L 581 3500 
L 1159 3500 
L 1159 2956 
Q 1366 3272 1645 3428 
Q 1925 3584 2291 3584 
Q 2894 3584 3203 3211 
Q 3513 2838 3513 2113 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-69-cifar10-svg" d="M 603 3500 
L 1178 3500 
L 1178 0 
L 603 0 
L 603 3500 
z
M 603 4863 
L 1178 4863 
L 1178 4134 
L 603 4134 
L 603 4863 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-67-cifar10-svg" d="M 2906 1791 
Q 2906 2416 2648 2759 
Q 2391 3103 1925 3103 
Q 1463 3103 1205 2759 
Q 947 2416 947 1791 
Q 947 1169 1205 825 
Q 1463 481 1925 481 
Q 2391 481 2648 825 
Q 2906 1169 2906 1791 
z
M 3481 434 
Q 3481 -459 3084 -895 
Q 2688 -1331 1869 -1331 
Q 1566 -1331 1297 -1286 
Q 1028 -1241 775 -1147 
L 775 -588 
Q 1028 -725 1275 -790 
Q 1522 -856 1778 -856 
Q 2344 -856 2625 -561 
Q 2906 -266 2906 331 
L 2906 616 
Q 2728 306 2450 153 
Q 2172 0 1784 0 
Q 1141 0 747 490 
Q 353 981 353 1791 
Q 353 2603 747 3093 
Q 1141 3584 1784 3584 
Q 2172 3584 2450 3431 
Q 2728 3278 2906 2969 
L 2906 3500 
L 3481 3500 
L 3481 434 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-20-cifar10-svg" transform="scale(0.015625)"/>
       <path id="DejaVuSans-74-cifar10-svg" d="M 1172 4494 
L 1172 3500 
L 2356 3500 
L 2356 3053 
L 1172 3053 
L 1172 1153 
Q 1172 725 1289 603 
Q 1406 481 1766 481 
L 2356 481 
L 2356 0 
L 1766 0 
Q 1100 0 847 248 
Q 594 497 594 1153 
L 594 3053 
L 172 3053 
L 172 3500 
L 594 3500 
L 594 4494 
L 1172 4494 
z
" transform="scale(0.015625)"/>
      </defs>
      <use xlink:href="#DejaVuSans-4c-cifar10-svg"/>
      <use xlink:href="#DejaVuSans-65-cifar10-svg" transform="translate(53.962891 0)"/>
      <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(115.486328 0)"/>
      <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(176.765625 0)"/>
      <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(216.128906 0)"/>
      <use xlink:href="#DejaVuSans-69-cifar10-svg" transform="translate(279.507812 0)"/>
      <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(307.291016 0)"/>
      <use xlink:href="#DejaVuSans-67-cifar10-svg" transform="translate(370.669922 0)"/>
      <use xlink:href="#DejaVuSans-20-cifar10-svg" transform="translate(434.146484 0)"/>
      <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(465.933594 0)"/>
      <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(507.046875 0)"/>
      <use xlink:href="#DejaVuSans-74-cifar10-svg" transform="translate(568.326172 0)"/>
      <use xlink:href="#DejaVuSans-65-cifar10-svg" transform="translate(607.535156 0)"/>
     </g>
    </g>
   </g>
   <g id="matplotlib.axis_2-cifar10-svg">
    <g id="ytick_1-cifar10-svg">
     <g id="line2d_4-cifar10-svg">
      <defs>
       <path id="mb2c4bc9246-cifar10-svg" d="M 0 0 
L -3.5 0 
" style="stroke: #000000; stroke-width: 0.8"/>
      </defs>
      <g>
       <use xlink:href="#mb2c4bc9246-cifar10-svg" x="57.62" y="160.448833" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_5-cifar10-svg">
      <!-- 20 -->
      <g transform="translate(32.805 165.76774) scale(0.14 -0.14)">
       <defs>
        <path id="DejaVuSans-32-cifar10-svg" d="M 1228 531 
L 3431 531 
L 3431 0 
L 469 0 
L 469 531 
Q 828 903 1448 1529 
Q 2069 2156 2228 2338 
Q 2531 2678 2651 2914 
Q 2772 3150 2772 3378 
Q 2772 3750 2511 3984 
Q 2250 4219 1831 4219 
Q 1534 4219 1204 4116 
Q 875 4013 500 3803 
L 500 4441 
Q 881 4594 1212 4672 
Q 1544 4750 1819 4750 
Q 2544 4750 2975 4387 
Q 3406 4025 3406 3419 
Q 3406 3131 3298 2873 
Q 3191 2616 2906 2266 
Q 2828 2175 2409 1742 
Q 1991 1309 1228 531 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-32-cifar10-svg"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0)"/>
      </g>
     </g>
    </g>
    <g id="ytick_2-cifar10-svg">
     <g id="line2d_5-cifar10-svg">
      <g>
       <use xlink:href="#mb2c4bc9246-cifar10-svg" x="57.62" y="103.834437" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_6-cifar10-svg">
      <!-- 40 -->
      <g transform="translate(32.805 109.153343) scale(0.14 -0.14)">
       <defs>
        <path id="DejaVuSans-34-cifar10-svg" d="M 2419 4116 
L 825 1625 
L 2419 1625 
L 2419 4116 
z
M 2253 4666 
L 3047 4666 
L 3047 1625 
L 3713 1625 
L 3713 1100 
L 3047 1100 
L 3047 0 
L 2419 0 
L 2419 1100 
L 313 1100 
L 313 1709 
L 2253 4666 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-34-cifar10-svg"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0)"/>
      </g>
     </g>
    </g>
    <g id="ytick_3-cifar10-svg">
     <g id="line2d_6-cifar10-svg">
      <g>
       <use xlink:href="#mb2c4bc9246-cifar10-svg" x="57.62" y="47.220041" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_7-cifar10-svg">
      <!-- 60 -->
      <g transform="translate(32.805 52.538947) scale(0.14 -0.14)">
       <defs>
        <path id="DejaVuSans-36-cifar10-svg" d="M 2113 2584 
Q 1688 2584 1439 2293 
Q 1191 2003 1191 1497 
Q 1191 994 1439 701 
Q 1688 409 2113 409 
Q 2538 409 2786 701 
Q 3034 994 3034 1497 
Q 3034 2003 2786 2293 
Q 2538 2584 2113 2584 
z
M 3366 4563 
L 3366 3988 
Q 3128 4100 2886 4159 
Q 2644 4219 2406 4219 
Q 1781 4219 1451 3797 
Q 1122 3375 1075 2522 
Q 1259 2794 1537 2939 
Q 1816 3084 2150 3084 
Q 2853 3084 3261 2657 
Q 3669 2231 3669 1497 
Q 3669 778 3244 343 
Q 2819 -91 2113 -91 
Q 1303 -91 875 529 
Q 447 1150 447 2328 
Q 447 3434 972 4092 
Q 1497 4750 2381 4750 
Q 2619 4750 2861 4703 
Q 3103 4656 3366 4563 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-36-cifar10-svg"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0)"/>
      </g>
     </g>
    </g>
    <g id="text_8-cifar10-svg">
     <!-- Accuracy -->
     <g transform="translate(25.893438 146.135375) rotate(-90) scale(0.14 -0.14)">
      <defs>
       <path id="DejaVuSans-41-cifar10-svg" d="M 2188 4044 
L 1331 1722 
L 3047 1722 
L 2188 4044 
z
M 1831 4666 
L 2547 4666 
L 4325 0 
L 3669 0 
L 3244 1197 
L 1141 1197 
L 716 0 
L 50 0 
L 1831 4666 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-63-cifar10-svg" d="M 3122 3366 
L 3122 2828 
Q 2878 2963 2633 3030 
Q 2388 3097 2138 3097 
Q 1578 3097 1268 2742 
Q 959 2388 959 1747 
Q 959 1106 1268 751 
Q 1578 397 2138 397 
Q 2388 397 2633 464 
Q 2878 531 3122 666 
L 3122 134 
Q 2881 22 2623 -34 
Q 2366 -91 2075 -91 
Q 1284 -91 818 406 
Q 353 903 353 1747 
Q 353 2603 823 3093 
Q 1294 3584 2113 3584 
Q 2378 3584 2631 3529 
Q 2884 3475 3122 3366 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-75-cifar10-svg" d="M 544 1381 
L 544 3500 
L 1119 3500 
L 1119 1403 
Q 1119 906 1312 657 
Q 1506 409 1894 409 
Q 2359 409 2629 706 
Q 2900 1003 2900 1516 
L 2900 3500 
L 3475 3500 
L 3475 0 
L 2900 0 
L 2900 538 
Q 2691 219 2414 64 
Q 2138 -91 1772 -91 
Q 1169 -91 856 284 
Q 544 659 544 1381 
z
M 1991 3584 
L 1991 3584 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-79-cifar10-svg" d="M 2059 -325 
Q 1816 -950 1584 -1140 
Q 1353 -1331 966 -1331 
L 506 -1331 
L 506 -850 
L 844 -850 
Q 1081 -850 1212 -737 
Q 1344 -625 1503 -206 
L 1606 56 
L 191 3500 
L 800 3500 
L 1894 763 
L 2988 3500 
L 3597 3500 
L 2059 -325 
z
" transform="scale(0.015625)"/>
      </defs>
      <use xlink:href="#DejaVuSans-41-cifar10-svg"/>
      <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(66.658203 0)"/>
      <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(121.638672 0)"/>
      <use xlink:href="#DejaVuSans-75-cifar10-svg" transform="translate(176.619141 0)"/>
      <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(239.998047 0)"/>
      <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(281.111328 0)"/>
      <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(342.390625 0)"/>
      <use xlink:href="#DejaVuSans-79-cifar10-svg" transform="translate(397.371094 0)"/>
     </g>
    </g>
   </g>
   <g id="line2d_7-cifar10-svg">
    <path clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_8-cifar10-svg">
    <path d="M 65.899121 106.701013 
L 76.248021 95.289437 
L 86.596922 85.910319 
L 96.945823 77.342674 
L 107.294724 70.558382 
L 117.643625 70.899955 
L 127.992525 83.207925 
L 138.341426 134.755333 
L 148.690327 184.798685 
L 159.039228 188.729611 
L 169.388129 188.740934 
L 179.737029 188.742821 
L 190.08593 188.73716 
L 200.434831 188.756031 
L 210.783732 188.740934 
L 221.132632 188.733386 
L 231.481533 188.740934 
" clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_9-cifar10-svg">
    <path d="M 65.899121 106.701013 
L 76.248021 95.246033 
L 86.596922 85.927303 
L 96.945823 77.459677 
L 107.294724 70.731999 
L 117.643625 70.905617 
L 127.992525 83.451367 
L 138.341426 133.975942 
L 148.690327 185.781888 
L 159.039228 188.720176 
L 169.388129 188.739047 
L 179.737029 188.73716 
L 190.08593 188.735273 
L 200.434831 188.756031 
L 210.783732 188.742821 
L 221.132632 188.746596 
L 231.481533 188.75037 
" clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_10-cifar10-svg">
    <path d="M 65.899121 106.712335 
L 76.248021 95.268679 
L 86.596922 85.976369 
L 96.945823 77.36532 
L 107.294724 70.488557 
L 117.643625 70.826357 
L 127.992525 83.338138 
L 138.341426 143.207862 
L 148.690327 187.521838 
L 159.039228 188.733386 
L 169.388129 188.739047 
L 179.737029 188.748483 
L 190.08593 188.73716 
L 200.434831 188.748483 
L 210.783732 188.748483 
L 221.132632 188.742821 
L 231.481533 188.748483 
" clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_11-cifar10-svg">
    <path d="M 65.899121 106.710448 
L 76.248021 95.285663 
L 86.596922 85.965046 
L 96.945823 77.504968 
L 107.294724 70.884858 
L 117.643625 70.924488 
L 127.992525 82.571957 
L 138.341426 142.181255 
L 148.690327 184.375964 
L 159.039228 188.706966 
L 169.388129 188.716401 
L 179.737029 188.744709 
L 190.08593 188.744709 
L 200.434831 188.746596 
L 210.783732 188.748483 
L 221.132632 188.025706 
L 231.481533 184.209895 
" clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_12-cifar10-svg">
    <path d="M 65.899121 106.942567 
L 76.248021 95.521556 
L 86.596922 86.55761 
L 96.945823 78.471187 
L 107.294724 72.139811 
L 117.643625 72.985252 
L 127.992525 81.632158 
L 138.341426 121.479257 
L 148.690327 139.84308 
L 159.039228 166.376361 
L 169.388129 188.756031 
L 179.737029 188.748483 
L 190.08593 188.720176 
L 200.434831 183.066285 
L 210.783732 179.550531 
" clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_13-cifar10-svg">
    <path d="M 65.899121 109.092027 
L 76.248021 99.237348 
L 86.596922 92.062417 
L 96.945823 88.173008 
L 107.294724 86.351911 
L 117.643625 88.510807 
L 127.992525 96.62365 
L 138.341426 108.929733 
L 148.690327 128.450376 
L 159.039228 146.38393 
L 169.388129 173.288978 
L 179.737029 188.839066 
" clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_14-cifar10-svg">
    <path d="M 65.899121 186.831142 
L 76.248021 186.506553 
L 86.596922 185.432766 
L 96.945823 179.420317 
L 107.294724 153.164448 
L 117.643625 119.448687 
L 127.992525 96.799155 
L 138.341426 79.603475 
L 148.690327 63.472147 
L 159.039228 48.350441 
L 169.388129 39.397818 
L 179.737029 46.365163 
L 190.08593 60.190399 
L 200.434831 74.072249 
L 210.783732 84.081674 
L 221.132632 94.676115 
L 231.481533 105.24791 
" clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_15-cifar10-svg">
    <path clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_16-cifar10-svg">
    <path clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_17-cifar10-svg">
    <path clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_18-cifar10-svg">
    <path clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_19-cifar10-svg">
    <path clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_20-cifar10-svg">
    <path clip-path="url(#pc22f2d41b5-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="patch_3-cifar10-svg">
    <path d="M 57.62 196.432 
L 57.62 31.92 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_4-cifar10-svg">
    <path d="M 239.760654 196.432 
L 239.760654 31.92 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_5-cifar10-svg">
    <path d="M 57.62 196.432 
L 239.760654 196.432 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_6-cifar10-svg">
    <path d="M 57.62 31.92 
L 239.760654 31.92 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="text_9-cifar10-svg">
    <!-- Train accuracy -->
    <g transform="translate(98.091264 25.92) scale(0.14 -0.14)">
     <defs>
      <path id="DejaVuSans-54-cifar10-svg" d="M -19 4666 
L 3928 4666 
L 3928 4134 
L 2272 4134 
L 2272 0 
L 1638 0 
L 1638 4134 
L -19 4134 
L -19 4666 
z
" transform="scale(0.015625)"/>
     </defs>
     <use xlink:href="#DejaVuSans-54-cifar10-svg"/>
     <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(46.333984 0)"/>
     <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(87.447266 0)"/>
     <use xlink:href="#DejaVuSans-69-cifar10-svg" transform="translate(148.726562 0)"/>
     <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(176.509766 0)"/>
     <use xlink:href="#DejaVuSans-20-cifar10-svg" transform="translate(239.888672 0)"/>
     <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(271.675781 0)"/>
     <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(332.955078 0)"/>
     <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(387.935547 0)"/>
     <use xlink:href="#DejaVuSans-75-cifar10-svg" transform="translate(442.916016 0)"/>
     <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(506.294922 0)"/>
     <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(547.408203 0)"/>
     <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(608.6875 0)"/>
     <use xlink:href="#DejaVuSans-79-cifar10-svg" transform="translate(663.667969 0)"/>
    </g>
   </g>
  </g>
  <g id="axes_2-cifar10-svg">
   <g id="patch_7-cifar10-svg">
    <path d="M 290.179673 196.432 
L 472.320327 196.432 
L 472.320327 31.92 
L 290.179673 31.92 
z
" style="fill: #ffffff"/>
   </g>
   <g id="matplotlib.axis_3-cifar10-svg">
    <g id="xtick_4-cifar10-svg">
     <g id="line2d_21-cifar10-svg">
      <g>
       <use xlink:href="#me864329786-cifar10-svg" x="329.859591" y="196.432" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_10-cifar10-svg">
      <!-- $\mathdefault{10^{-3}}$ -->
      <g transform="translate(313.409591 214.069812) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-31-cifar10-svg" transform="translate(0 0.765625)"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0.765625)"/>
       <use xlink:href="#DejaVuSans-2212-cifar10-svg" transform="translate(128.203125 39.046875) scale(0.7)"/>
       <use xlink:href="#DejaVuSans-33-cifar10-svg" transform="translate(186.855469 39.046875) scale(0.7)"/>
      </g>
     </g>
    </g>
    <g id="xtick_5-cifar10-svg">
     <g id="line2d_22-cifar10-svg">
      <g>
       <use xlink:href="#me864329786-cifar10-svg" x="398.6162" y="196.432" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_11-cifar10-svg">
      <!-- $\mathdefault{10^{-1}}$ -->
      <g transform="translate(382.1662 214.069812) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-31-cifar10-svg" transform="translate(0 0.684375)"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0.684375)"/>
       <use xlink:href="#DejaVuSans-2212-cifar10-svg" transform="translate(128.203125 38.965625) scale(0.7)"/>
       <use xlink:href="#DejaVuSans-31-cifar10-svg" transform="translate(186.855469 38.965625) scale(0.7)"/>
      </g>
     </g>
    </g>
    <g id="xtick_6-cifar10-svg">
     <g id="line2d_23-cifar10-svg">
      <g>
       <use xlink:href="#me864329786-cifar10-svg" x="467.372808" y="196.432" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_12-cifar10-svg">
      <!-- $\mathdefault{10^{1}}$ -->
      <g transform="translate(455.052808 214.069812) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-31-cifar10-svg" transform="translate(0 0.684375)"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0.684375)"/>
       <use xlink:href="#DejaVuSans-31-cifar10-svg" transform="translate(128.203125 38.965625) scale(0.7)"/>
      </g>
     </g>
    </g>
    <g id="text_13-cifar10-svg">
     <!-- Learning rate -->
     <g transform="translate(334.415625 231.619187) scale(0.14 -0.14)">
      <use xlink:href="#DejaVuSans-4c-cifar10-svg"/>
      <use xlink:href="#DejaVuSans-65-cifar10-svg" transform="translate(53.962891 0)"/>
      <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(115.486328 0)"/>
      <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(176.765625 0)"/>
      <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(216.128906 0)"/>
      <use xlink:href="#DejaVuSans-69-cifar10-svg" transform="translate(279.507812 0)"/>
      <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(307.291016 0)"/>
      <use xlink:href="#DejaVuSans-67-cifar10-svg" transform="translate(370.669922 0)"/>
      <use xlink:href="#DejaVuSans-20-cifar10-svg" transform="translate(434.146484 0)"/>
      <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(465.933594 0)"/>
      <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(507.046875 0)"/>
      <use xlink:href="#DejaVuSans-74-cifar10-svg" transform="translate(568.326172 0)"/>
      <use xlink:href="#DejaVuSans-65-cifar10-svg" transform="translate(607.535156 0)"/>
     </g>
    </g>
   </g>
   <g id="matplotlib.axis_4-cifar10-svg">
    <g id="ytick_4-cifar10-svg">
     <g id="line2d_24-cifar10-svg">
      <g>
       <use xlink:href="#mb2c4bc9246-cifar10-svg" x="290.179673" y="160.448833" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_14-cifar10-svg">
      <!-- 20 -->
      <g transform="translate(265.364673 165.76774) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-32-cifar10-svg"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0)"/>
      </g>
     </g>
    </g>
    <g id="ytick_5-cifar10-svg">
     <g id="line2d_25-cifar10-svg">
      <g>
       <use xlink:href="#mb2c4bc9246-cifar10-svg" x="290.179673" y="103.834437" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_15-cifar10-svg">
      <!-- 40 -->
      <g transform="translate(265.364673 109.153343) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-34-cifar10-svg"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0)"/>
      </g>
     </g>
    </g>
    <g id="ytick_6-cifar10-svg">
     <g id="line2d_26-cifar10-svg">
      <g>
       <use xlink:href="#mb2c4bc9246-cifar10-svg" x="290.179673" y="47.220041" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_16-cifar10-svg">
      <!-- 60 -->
      <g transform="translate(265.364673 52.538947) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-36-cifar10-svg"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0)"/>
      </g>
     </g>
    </g>
    <g id="text_17-cifar10-svg">
     <!-- Accuracy -->
     <g transform="translate(258.453111 146.135375) rotate(-90) scale(0.14 -0.14)">
      <use xlink:href="#DejaVuSans-41-cifar10-svg"/>
      <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(66.658203 0)"/>
      <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(121.638672 0)"/>
      <use xlink:href="#DejaVuSans-75-cifar10-svg" transform="translate(176.619141 0)"/>
      <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(239.998047 0)"/>
      <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(281.111328 0)"/>
      <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(342.390625 0)"/>
      <use xlink:href="#DejaVuSans-79-cifar10-svg" transform="translate(397.371094 0)"/>
     </g>
    </g>
   </g>
   <g id="line2d_27-cifar10-svg">
    <path clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_28-cifar10-svg">
    <path d="M 298.458794 107.306787 
L 308.807694 95.917857 
L 319.156595 87.604977 
L 329.505496 82.339838 
L 339.854397 78.159808 
L 350.203298 78.905231 
L 360.552198 88.152249 
L 370.901099 134.877998 
L 381.25 184.717538 
L 391.598901 188.727724 
L 401.947802 188.746596 
L 412.296702 188.73716 
L 422.645603 188.756031 
L 432.994504 188.756031 
L 443.343405 188.746596 
L 453.692306 188.756031 
L 464.041206 188.756031 
" clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_29-cifar10-svg">
    <path d="M 298.458794 107.391708 
L 308.807694 95.946164 
L 319.156595 87.520055 
L 329.505496 82.415324 
L 339.854397 78.018272 
L 350.203298 78.688209 
L 360.552198 88.086199 
L 370.901099 133.849503 
L 381.25 185.529011 
L 391.598901 188.73716 
L 401.947802 188.746596 
L 412.296702 188.73716 
L 422.645603 188.756031 
L 432.994504 188.756031 
L 443.343405 188.746596 
L 453.692306 188.756031 
L 464.041206 188.756031 
" clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_30-cifar10-svg">
    <path d="M 298.458794 107.41058 
L 308.807694 95.785757 
L 319.156595 87.803127 
L 329.505496 82.085073 
L 339.854397 78.037144 
L 350.203298 79.424196 
L 360.552198 87.963534 
L 370.901099 142.973856 
L 381.25 187.548258 
L 391.598901 188.73716 
L 401.947802 188.756031 
L 412.296702 188.73716 
L 422.645603 188.756031 
L 432.994504 188.756031 
L 443.343405 188.756031 
L 453.692306 188.727724 
L 464.041206 188.756031 
" clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_31-cifar10-svg">
    <path d="M 298.458794 107.259608 
L 308.807694 95.927293 
L 319.156595 87.671027 
L 329.505496 82.405888 
L 339.854397 78.103194 
L 350.203298 79.093946 
L 360.552198 86.906732 
L 370.901099 142.558684 
L 381.25 184.793024 
L 391.598901 188.73716 
L 401.947802 188.708853 
L 412.296702 188.756031 
L 422.645603 188.756031 
L 432.994504 188.746596 
L 443.343405 188.727724 
L 453.692306 188.076659 
L 464.041206 183.707914 
" clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_32-cifar10-svg">
    <path d="M 298.458794 107.335094 
L 308.807694 96.097136 
L 319.156595 87.746513 
L 329.505496 82.575731 
L 339.854397 78.829745 
L 350.203298 79.103381 
L 360.552198 84.500621 
L 370.901099 121.875558 
L 381.25 139.93555 
L 391.598901 166.223502 
L 401.947802 188.756031 
L 412.296702 188.727724 
L 422.645603 188.784339 
L 432.994504 183.066285 
L 443.343405 178.905126 
" clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_33-cifar10-svg">
    <path d="M 298.458794 109.59967 
L 308.807694 99.163749 
L 319.156595 91.926542 
L 329.505496 88.3504 
L 339.854397 87.255855 
L 350.203298 89.482687 
L 360.552198 96.39908 
L 370.901099 108.712711 
L 381.25 128.329599 
L 391.598901 146.644356 
L 401.947802 173.026665 
L 412.296702 188.954182 
" clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_34-cifar10-svg">
    <path d="M 298.458794 186.491456 
L 308.807694 186.227255 
L 319.156595 185.378039 
L 329.505496 179.150456 
L 339.854397 153.117269 
L 350.203298 120.375276 
L 360.552198 100.409266 
L 370.901099 86.576482 
L 381.25 77.716329 
L 391.598901 72.639905 
L 401.947802 69.346834 
L 412.296702 70.83768 
L 422.645603 77.433257 
L 432.994504 84.830871 
L 443.343405 91.417013 
L 453.692306 99.371335 
L 464.041206 107.703087 
" clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_35-cifar10-svg">
    <path clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_36-cifar10-svg">
    <path clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_37-cifar10-svg">
    <path clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_38-cifar10-svg">
    <path clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_39-cifar10-svg">
    <path clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_40-cifar10-svg">
    <path clip-path="url(#pa7d198305a-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="patch_8-cifar10-svg">
    <path d="M 290.179673 196.432 
L 290.179673 31.92 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_9-cifar10-svg">
    <path d="M 472.320327 196.432 
L 472.320327 31.92 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_10-cifar10-svg">
    <path d="M 290.179673 196.432 
L 472.320327 196.432 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_11-cifar10-svg">
    <path d="M 290.179673 31.92 
L 472.320327 31.92 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="text_18-cifar10-svg">
    <!-- Test accuracy -->
    <g transform="translate(333.65875 25.92) scale(0.14 -0.14)">
     <defs>
      <path id="DejaVuSans-73-cifar10-svg" d="M 2834 3397 
L 2834 2853 
Q 2591 2978 2328 3040 
Q 2066 3103 1784 3103 
Q 1356 3103 1142 2972 
Q 928 2841 928 2578 
Q 928 2378 1081 2264 
Q 1234 2150 1697 2047 
L 1894 2003 
Q 2506 1872 2764 1633 
Q 3022 1394 3022 966 
Q 3022 478 2636 193 
Q 2250 -91 1575 -91 
Q 1294 -91 989 -36 
Q 684 19 347 128 
L 347 722 
Q 666 556 975 473 
Q 1284 391 1588 391 
Q 1994 391 2212 530 
Q 2431 669 2431 922 
Q 2431 1156 2273 1281 
Q 2116 1406 1581 1522 
L 1381 1569 
Q 847 1681 609 1914 
Q 372 2147 372 2553 
Q 372 3047 722 3315 
Q 1072 3584 1716 3584 
Q 2034 3584 2315 3537 
Q 2597 3491 2834 3397 
z
" transform="scale(0.015625)"/>
     </defs>
     <use xlink:href="#DejaVuSans-54-cifar10-svg"/>
     <use xlink:href="#DejaVuSans-65-cifar10-svg" transform="translate(44.083984 0)"/>
     <use xlink:href="#DejaVuSans-73-cifar10-svg" transform="translate(105.607422 0)"/>
     <use xlink:href="#DejaVuSans-74-cifar10-svg" transform="translate(157.707031 0)"/>
     <use xlink:href="#DejaVuSans-20-cifar10-svg" transform="translate(196.916016 0)"/>
     <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(228.703125 0)"/>
     <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(289.982422 0)"/>
     <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(344.962891 0)"/>
     <use xlink:href="#DejaVuSans-75-cifar10-svg" transform="translate(399.943359 0)"/>
     <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(463.322266 0)"/>
     <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(504.435547 0)"/>
     <use xlink:href="#DejaVuSans-63-cifar10-svg" transform="translate(565.714844 0)"/>
     <use xlink:href="#DejaVuSans-79-cifar10-svg" transform="translate(620.695312 0)"/>
    </g>
   </g>
  </g>
  <g id="axes_3-cifar10-svg">
   <g id="patch_12-cifar10-svg">
    <path d="M 522.739346 196.432 
L 704.88 196.432 
L 704.88 31.92 
L 522.739346 31.92 
z
" style="fill: #ffffff"/>
   </g>
   <g id="matplotlib.axis_5-cifar10-svg">
    <g id="xtick_7-cifar10-svg">
     <g id="line2d_41-cifar10-svg">
      <g>
       <use xlink:href="#me864329786-cifar10-svg" x="531.018467" y="196.432" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_19-cifar10-svg">
      <!-- 0 -->
      <g transform="translate(526.564717 214.069812) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-30-cifar10-svg"/>
      </g>
     </g>
    </g>
    <g id="xtick_8-cifar10-svg">
     <g id="line2d_42-cifar10-svg">
      <g>
       <use xlink:href="#me864329786-cifar10-svg" x="596.208393" y="196.432" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_20-cifar10-svg">
      <!-- 50 -->
      <g transform="translate(587.300893 214.069812) scale(0.14 -0.14)">
       <defs>
        <path id="DejaVuSans-35-cifar10-svg" d="M 691 4666 
L 3169 4666 
L 3169 4134 
L 1269 4134 
L 1269 2991 
Q 1406 3038 1543 3061 
Q 1681 3084 1819 3084 
Q 2600 3084 3056 2656 
Q 3513 2228 3513 1497 
Q 3513 744 3044 326 
Q 2575 -91 1722 -91 
Q 1428 -91 1123 -41 
Q 819 9 494 109 
L 494 744 
Q 775 591 1075 516 
Q 1375 441 1709 441 
Q 2250 441 2565 725 
Q 2881 1009 2881 1497 
Q 2881 1984 2565 2268 
Q 2250 2553 1709 2553 
Q 1456 2553 1204 2497 
Q 953 2441 691 2322 
L 691 4666 
z
" transform="scale(0.015625)"/>
       </defs>
       <use xlink:href="#DejaVuSans-35-cifar10-svg"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0)"/>
      </g>
     </g>
    </g>
    <g id="xtick_9-cifar10-svg">
     <g id="line2d_43-cifar10-svg">
      <g>
       <use xlink:href="#me864329786-cifar10-svg" x="661.398319" y="196.432" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_21-cifar10-svg">
      <!-- 100 -->
      <g transform="translate(648.037069 214.069812) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-31-cifar10-svg"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(63.623047 0)"/>
       <use xlink:href="#DejaVuSans-30-cifar10-svg" transform="translate(127.246094 0)"/>
      </g>
     </g>
    </g>
    <g id="text_22-cifar10-svg">
     <!-- Index $i$ -->
     <g transform="translate(590.219673 231.619187) scale(0.14 -0.14)">
      <defs>
       <path id="DejaVuSans-49-cifar10-svg" d="M 628 4666 
L 1259 4666 
L 1259 0 
L 628 0 
L 628 4666 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-64-cifar10-svg" d="M 2906 2969 
L 2906 4863 
L 3481 4863 
L 3481 0 
L 2906 0 
L 2906 525 
Q 2725 213 2448 61 
Q 2172 -91 1784 -91 
Q 1150 -91 751 415 
Q 353 922 353 1747 
Q 353 2572 751 3078 
Q 1150 3584 1784 3584 
Q 2172 3584 2448 3432 
Q 2725 3281 2906 2969 
z
M 947 1747 
Q 947 1113 1208 752 
Q 1469 391 1925 391 
Q 2381 391 2643 752 
Q 2906 1113 2906 1747 
Q 2906 2381 2643 2742 
Q 2381 3103 1925 3103 
Q 1469 3103 1208 2742 
Q 947 2381 947 1747 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-78-cifar10-svg" d="M 3513 3500 
L 2247 1797 
L 3578 0 
L 2900 0 
L 1881 1375 
L 863 0 
L 184 0 
L 1544 1831 
L 300 3500 
L 978 3500 
L 1906 2253 
L 2834 3500 
L 3513 3500 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-Oblique-69-cifar10-svg" d="M 1172 4863 
L 1747 4863 
L 1606 4134 
L 1031 4134 
L 1172 4863 
z
M 909 3500 
L 1484 3500 
L 800 0 
L 225 0 
L 909 3500 
z
" transform="scale(0.015625)"/>
      </defs>
      <use xlink:href="#DejaVuSans-49-cifar10-svg" transform="translate(0 0.015625)"/>
      <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(29.492188 0.015625)"/>
      <use xlink:href="#DejaVuSans-64-cifar10-svg" transform="translate(92.871094 0.015625)"/>
      <use xlink:href="#DejaVuSans-65-cifar10-svg" transform="translate(156.347656 0.015625)"/>
      <use xlink:href="#DejaVuSans-78-cifar10-svg" transform="translate(217.871094 0.015625)"/>
      <use xlink:href="#DejaVuSans-20-cifar10-svg" transform="translate(277.050781 0.015625)"/>
      <use xlink:href="#DejaVuSans-Oblique-69-cifar10-svg" transform="translate(308.837891 0.015625)"/>
     </g>
    </g>
   </g>
   <g id="matplotlib.axis_6-cifar10-svg">
    <g id="ytick_7-cifar10-svg">
     <g id="line2d_44-cifar10-svg">
      <g>
       <use xlink:href="#mb2c4bc9246-cifar10-svg" x="522.739346" y="195.607038" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_23-cifar10-svg">
      <!-- 0 -->
      <g transform="translate(506.831846 200.925944) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-30-cifar10-svg"/>
      </g>
     </g>
    </g>
    <g id="ytick_8-cifar10-svg">
     <g id="line2d_45-cifar10-svg">
      <g>
       <use xlink:href="#mb2c4bc9246-cifar10-svg" x="522.739346" y="144.163408" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_24-cifar10-svg">
      <!-- 1 -->
      <g transform="translate(506.831846 149.482314) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-31-cifar10-svg"/>
      </g>
     </g>
    </g>
    <g id="ytick_9-cifar10-svg">
     <g id="line2d_46-cifar10-svg">
      <g>
       <use xlink:href="#mb2c4bc9246-cifar10-svg" x="522.739346" y="92.719778" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_25-cifar10-svg">
      <!-- 2 -->
      <g transform="translate(506.831846 98.038684) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-32-cifar10-svg"/>
      </g>
     </g>
    </g>
    <g id="ytick_10-cifar10-svg">
     <g id="line2d_47-cifar10-svg">
      <g>
       <use xlink:href="#mb2c4bc9246-cifar10-svg" x="522.739346" y="41.276147" style="stroke: #000000; stroke-width: 0.8"/>
      </g>
     </g>
     <g id="text_26-cifar10-svg">
      <!-- 3 -->
      <g transform="translate(506.831846 46.595054) scale(0.14 -0.14)">
       <use xlink:href="#DejaVuSans-33-cifar10-svg"/>
      </g>
     </g>
    </g>
    <g id="text_27-cifar10-svg">
     <!-- Singular value $\sigma_i$ -->
     <g transform="translate(499.891846 172.556) rotate(-90) scale(0.14 -0.14)">
      <defs>
       <path id="DejaVuSans-53-cifar10-svg" d="M 3425 4513 
L 3425 3897 
Q 3066 4069 2747 4153 
Q 2428 4238 2131 4238 
Q 1616 4238 1336 4038 
Q 1056 3838 1056 3469 
Q 1056 3159 1242 3001 
Q 1428 2844 1947 2747 
L 2328 2669 
Q 3034 2534 3370 2195 
Q 3706 1856 3706 1288 
Q 3706 609 3251 259 
Q 2797 -91 1919 -91 
Q 1588 -91 1214 -16 
Q 841 59 441 206 
L 441 856 
Q 825 641 1194 531 
Q 1563 422 1919 422 
Q 2459 422 2753 634 
Q 3047 847 3047 1241 
Q 3047 1584 2836 1778 
Q 2625 1972 2144 2069 
L 1759 2144 
Q 1053 2284 737 2584 
Q 422 2884 422 3419 
Q 422 4038 858 4394 
Q 1294 4750 2059 4750 
Q 2388 4750 2728 4690 
Q 3069 4631 3425 4513 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-6c-cifar10-svg" d="M 603 4863 
L 1178 4863 
L 1178 0 
L 603 0 
L 603 4863 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-76-cifar10-svg" d="M 191 3500 
L 800 3500 
L 1894 563 
L 2988 3500 
L 3597 3500 
L 2284 0 
L 1503 0 
L 191 3500 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-Oblique-3c3-cifar10-svg" d="M 2219 3044 
Q 1744 3044 1422 2700 
Q 1081 2341 969 1747 
Q 844 1119 1044 756 
Q 1241 397 1706 397 
Q 2166 397 2503 759 
Q 2844 1122 2966 1747 
Q 3075 2319 2881 2700 
Q 2700 3044 2219 3044 
z
M 2309 3503 
L 4219 3500 
L 4106 2925 
L 3463 2925 
Q 3706 2438 3575 1747 
Q 3406 888 2884 400 
Q 2359 -91 1609 -91 
Q 856 -91 525 400 
Q 194 888 363 1747 
Q 528 2609 1050 3097 
Q 1484 3503 2309 3503 
z
" transform="scale(0.015625)"/>
      </defs>
      <use xlink:href="#DejaVuSans-53-cifar10-svg" transform="translate(0 0.015625)"/>
      <use xlink:href="#DejaVuSans-69-cifar10-svg" transform="translate(63.476562 0.015625)"/>
      <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(91.259766 0.015625)"/>
      <use xlink:href="#DejaVuSans-67-cifar10-svg" transform="translate(154.638672 0.015625)"/>
      <use xlink:href="#DejaVuSans-75-cifar10-svg" transform="translate(218.115234 0.015625)"/>
      <use xlink:href="#DejaVuSans-6c-cifar10-svg" transform="translate(281.494141 0.015625)"/>
      <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(309.277344 0.015625)"/>
      <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(370.556641 0.015625)"/>
      <use xlink:href="#DejaVuSans-20-cifar10-svg" transform="translate(411.669922 0.015625)"/>
      <use xlink:href="#DejaVuSans-76-cifar10-svg" transform="translate(443.457031 0.015625)"/>
      <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(502.636719 0.015625)"/>
      <use xlink:href="#DejaVuSans-6c-cifar10-svg" transform="translate(563.916016 0.015625)"/>
      <use xlink:href="#DejaVuSans-75-cifar10-svg" transform="translate(591.699219 0.015625)"/>
      <use xlink:href="#DejaVuSans-65-cifar10-svg" transform="translate(655.078125 0.015625)"/>
      <use xlink:href="#DejaVuSans-20-cifar10-svg" transform="translate(716.601562 0.015625)"/>
      <use xlink:href="#DejaVuSans-Oblique-3c3-cifar10-svg" transform="translate(748.388672 0.015625)"/>
      <use xlink:href="#DejaVuSans-Oblique-69-cifar10-svg" transform="translate(811.767578 -16.390625) scale(0.7)"/>
     </g>
    </g>
   </g>
   <g id="line2d_48-cifar10-svg">
    <path d="M 531.018467 40.446351 
L 532.322265 49.568605 
L 533.626064 62.981701 
L 534.929862 67.338614 
L 536.233661 70.65623 
L 537.537459 77.753477 
L 538.841258 80.895101 
L 540.145056 91.1899 
L 541.448855 95.149743 
L 542.752653 99.891983 
L 544.056452 103.441961 
L 545.360251 108.383896 
L 546.664049 111.149539 
L 547.967848 116.702614 
L 550.575445 124.21593 
L 551.879243 127.592026 
L 553.183042 129.564858 
L 554.48684 130.079907 
L 555.790639 132.788763 
L 557.094437 135.100241 
L 558.398236 136.423432 
L 559.702034 137.23921 
L 561.005833 140.793076 
L 562.309631 141.655228 
L 563.61343 142.265798 
L 564.917228 142.445298 
L 566.221027 145.841484 
L 568.828624 147.573518 
L 570.132422 148.040142 
L 571.436221 150.346474 
L 574.043818 151.453557 
L 575.347617 152.457972 
L 576.651415 153.310122 
L 577.955214 153.89817 
L 580.562811 154.576778 
L 581.866609 155.123201 
L 583.170408 155.355901 
L 584.474206 155.893929 
L 585.778005 156.093856 
L 587.081803 156.591323 
L 588.385602 156.901778 
L 589.6894 156.957553 
L 590.993199 157.234776 
L 592.296997 157.70808 
L 593.600796 158.050829 
L 594.904594 158.133803 
L 597.512192 158.803141 
L 600.119789 159.26507 
L 602.727386 159.489147 
L 604.031184 159.818153 
L 605.334983 159.975686 
L 606.638781 160.01697 
L 611.853975 161.022035 
L 614.461572 161.169284 
L 619.676766 161.574944 
L 622.284363 161.846963 
L 623.588162 162.180592 
L 627.499558 162.388618 
L 628.803356 162.642027 
L 635.322349 163.159953 
L 636.626147 163.364808 
L 643.14514 163.831299 
L 645.752737 164.14188 
L 653.575528 164.770991 
L 657.486924 165.061699 
L 661.398319 165.448578 
L 666.613513 165.83825 
L 669.22111 166.027641 
L 670.524909 166.050516 
L 671.828707 166.279322 
L 677.043902 166.741628 
L 678.3477 166.958229 
L 679.651499 167.015563 
L 680.955297 167.285711 
L 682.259096 167.336118 
L 683.562894 167.580509 
L 686.170491 167.70964 
L 688.778088 168.102593 
L 693.993282 168.609957 
L 695.297081 168.844298 
L 696.600879 169.323502 
L 696.600879 169.323502 
" clip-path="url(#p7a7923e430-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_49-cifar10-svg">
    <path d="M 531.018467 39.847273 
L 532.322265 48.753858 
L 533.626064 63.491353 
L 534.929862 67.268151 
L 536.233661 70.330333 
L 537.537459 77.361251 
L 538.841258 80.821387 
L 540.145056 91.905129 
L 541.448855 95.181589 
L 542.752653 99.999597 
L 544.056452 103.660452 
L 545.360251 108.271781 
L 546.664049 110.247587 
L 547.967848 116.905908 
L 549.271646 121.730723 
L 550.575445 124.206787 
L 551.879243 127.149955 
L 553.183042 129.35361 
L 554.48684 129.804838 
L 557.094437 134.652944 
L 558.398236 135.783371 
L 559.702034 137.265702 
L 561.005833 141.161036 
L 562.309631 141.714082 
L 563.61343 142.466793 
L 564.917228 143.376785 
L 566.221027 145.650146 
L 567.524825 146.255518 
L 568.828624 147.580442 
L 570.132422 148.274212 
L 571.436221 149.885297 
L 572.74002 151.070227 
L 576.651415 153.391179 
L 577.955214 153.85511 
L 579.259012 153.956932 
L 580.562811 154.787627 
L 581.866609 155.095 
L 583.170408 155.535119 
L 585.778005 156.003432 
L 587.081803 156.531193 
L 588.385602 156.892331 
L 594.904594 157.914527 
L 596.208393 158.375039 
L 597.512192 158.699372 
L 598.81599 158.800093 
L 600.119789 159.23931 
L 609.246378 160.467174 
L 610.550177 160.572697 
L 611.853975 160.869884 
L 613.157774 160.939537 
L 614.461572 161.165608 
L 615.765371 161.184652 
L 617.069169 161.342928 
L 618.372968 161.616274 
L 622.284363 161.833551 
L 623.588162 161.978767 
L 624.891961 162.250295 
L 627.499558 162.453114 
L 628.803356 162.727638 
L 635.322349 163.160146 
L 636.626147 163.382629 
L 641.841341 163.714915 
L 652.27173 164.657882 
L 658.790722 165.089854 
L 660.094521 165.300918 
L 665.309715 165.583718 
L 666.613513 165.801154 
L 673.132506 166.234401 
L 674.436304 166.53405 
L 677.043902 166.789618 
L 693.993282 168.648212 
L 696.600879 169.351393 
L 696.600879 169.351393 
" clip-path="url(#p7a7923e430-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_50-cifar10-svg">
    <path d="M 531.018467 39.624171 
L 532.322265 49.519729 
L 533.626064 64.800115 
L 534.929862 68.780808 
L 536.233661 71.277581 
L 537.537459 75.477206 
L 538.841258 81.617872 
L 540.145056 91.991242 
L 541.448855 94.333751 
L 542.752653 98.920966 
L 544.056452 104.546816 
L 545.360251 109.109415 
L 546.664049 109.941652 
L 547.967848 117.190631 
L 549.271646 120.496656 
L 550.575445 124.618435 
L 551.879243 125.681894 
L 554.48684 130.719104 
L 555.790639 132.92252 
L 557.094437 134.666994 
L 558.398236 135.538676 
L 559.702034 137.846106 
L 561.005833 140.971669 
L 562.309631 142.570218 
L 563.61343 143.055512 
L 570.132422 148.161122 
L 571.436221 149.527045 
L 572.74002 150.430328 
L 574.043818 152.363878 
L 576.651415 153.11296 
L 579.259012 154.029404 
L 581.866609 154.777165 
L 583.170408 155.593832 
L 584.474206 155.999862 
L 587.081803 156.278569 
L 588.385602 156.660112 
L 589.6894 157.208044 
L 592.296997 157.374031 
L 594.904594 158.189633 
L 596.208393 158.451156 
L 597.512192 158.846593 
L 598.81599 159.090647 
L 601.423587 159.297787 
L 604.031184 159.918506 
L 607.94258 160.366814 
L 609.246378 160.606254 
L 613.157774 160.927668 
L 614.461572 161.051027 
L 615.765371 161.295704 
L 619.676766 161.619761 
L 620.980565 161.783558 
L 622.284363 162.062381 
L 627.499558 162.433717 
L 631.410953 162.928274 
L 634.01855 163.108209 
L 636.626147 163.327755 
L 649.664132 164.534737 
L 656.183125 164.958099 
L 657.486924 165.198357 
L 665.309715 165.651326 
L 666.613513 165.952879 
L 667.917312 165.958687 
L 674.436304 166.545797 
L 675.740103 166.604608 
L 678.3477 166.9477 
L 679.651499 167.006956 
L 680.955297 167.278294 
L 683.562894 167.498802 
L 684.866693 167.565227 
L 690.081887 168.266764 
L 692.689484 168.47479 
L 695.297081 168.966465 
L 696.600879 169.540077 
L 696.600879 169.540077 
" clip-path="url(#p7a7923e430-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_51-cifar10-svg">
    <path d="M 531.018467 39.397818 
L 532.322265 50.136922 
L 533.626064 64.200522 
L 534.929862 67.749017 
L 536.233661 71.788926 
L 537.537459 77.739936 
L 538.841258 81.612291 
L 540.145056 92.80835 
L 541.448855 95.470157 
L 542.752653 99.204419 
L 544.056452 104.851131 
L 545.360251 108.715232 
L 546.664049 110.718353 
L 547.967848 117.736177 
L 549.271646 122.136208 
L 551.879243 127.893184 
L 553.183042 130.547687 
L 554.48684 132.477689 
L 555.790639 133.059558 
L 557.094437 133.783421 
L 558.398236 134.952268 
L 559.702034 138.382705 
L 561.005833 141.165586 
L 562.309631 142.886763 
L 563.61343 143.792327 
L 564.917228 144.361934 
L 566.221027 145.776329 
L 567.524825 146.855144 
L 570.132422 149.220954 
L 571.436221 149.459599 
L 572.74002 151.22148 
L 574.043818 152.697142 
L 575.347617 152.807878 
L 576.651415 153.265833 
L 577.955214 154.419091 
L 579.259012 154.845586 
L 580.562811 154.893874 
L 581.866609 155.391605 
L 583.170408 155.686976 
L 584.474206 156.252346 
L 588.385602 157.425149 
L 589.6894 157.580551 
L 592.296997 158.122445 
L 593.600796 158.27027 
L 594.904594 158.636482 
L 596.208393 159.221019 
L 597.512192 159.249413 
L 602.727386 159.975563 
L 604.031184 160.206292 
L 607.94258 160.599183 
L 609.246378 160.969504 
L 613.157774 161.440537 
L 620.980565 162.167499 
L 624.891961 162.698343 
L 626.195759 162.752484 
L 627.499558 163.042039 
L 631.410953 163.30492 
L 635.322349 163.753495 
L 637.929946 163.920868 
L 645.752737 164.591004 
L 649.664132 164.904699 
L 653.575528 165.10421 
L 654.879327 165.347231 
L 657.486924 165.565164 
L 658.790722 165.720474 
L 661.398319 165.776151 
L 664.005916 165.979473 
L 666.613513 166.13183 
L 670.524909 166.660776 
L 673.132506 166.842845 
L 679.651499 167.366974 
L 682.259096 167.780885 
L 687.47429 168.303382 
L 688.778088 168.55286 
L 692.689484 168.939638 
L 693.993282 169.249921 
L 695.297081 169.337024 
L 696.600879 169.801771 
L 696.600879 169.801771 
" clip-path="url(#p7a7923e430-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_52-cifar10-svg">
    <path d="M 531.018467 44.209424 
L 532.322265 52.910261 
L 533.626064 68.97034 
L 534.929862 70.892677 
L 536.233661 75.191944 
L 537.537459 80.52646 
L 538.841258 86.456362 
L 540.145056 95.770695 
L 541.448855 97.206879 
L 542.752653 102.32445 
L 545.360251 113.297676 
L 546.664049 114.328786 
L 549.271646 124.331002 
L 550.575445 129.009819 
L 551.879243 133.03707 
L 553.183042 134.069971 
L 554.48684 134.615652 
L 555.790639 135.527471 
L 557.094437 138.047677 
L 558.398236 139.215175 
L 559.702034 141.579749 
L 561.005833 145.78726 
L 562.309631 146.278671 
L 564.917228 148.74358 
L 566.221027 149.027965 
L 567.524825 150.539294 
L 568.828624 152.279809 
L 570.132422 153.263159 
L 571.436221 154.724983 
L 572.74002 155.244098 
L 574.043818 156.742534 
L 576.651415 157.766159 
L 577.955214 158.526461 
L 579.259012 158.767891 
L 584.474206 160.724226 
L 585.778005 160.865812 
L 587.081803 161.124431 
L 588.385602 161.771183 
L 593.600796 162.291267 
L 596.208393 162.890795 
L 597.512192 163.075737 
L 598.81599 163.470006 
L 602.727386 163.891916 
L 604.031184 164.28257 
L 605.334983 164.463127 
L 606.638781 164.48511 
L 607.94258 164.678126 
L 609.246378 164.731593 
L 613.157774 165.316583 
L 617.069169 165.748257 
L 618.372968 166.007631 
L 628.803356 166.664986 
L 630.107155 166.925601 
L 634.01855 167.181289 
L 652.27173 168.748363 
L 653.575528 168.796737 
L 654.879327 168.979567 
L 660.094521 169.27369 
L 670.524909 169.936313 
L 673.132506 170.243915 
L 675.740103 170.357717 
L 678.3477 170.593373 
L 679.651499 170.698175 
L 680.955297 170.971445 
L 682.259096 171.011817 
L 686.170491 171.511033 
L 690.081887 171.734921 
L 691.385685 171.902864 
L 692.689484 171.952072 
L 695.297081 172.386547 
L 696.600879 172.781657 
L 696.600879 172.781657 
" clip-path="url(#p7a7923e430-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_53-cifar10-svg">
    <path d="M 531.018467 60.243072 
L 532.322265 79.553787 
L 533.626064 84.911301 
L 534.929862 85.436825 
L 536.233661 95.52998 
L 537.537459 97.959798 
L 538.841258 102.975697 
L 540.145056 114.804967 
L 541.448855 120.120681 
L 542.752653 122.45599 
L 544.056452 128.025911 
L 545.360251 129.870223 
L 546.664049 135.453267 
L 547.967848 145.368922 
L 549.271646 150.938426 
L 550.575445 154.813369 
L 551.879243 157.421659 
L 553.183042 159.081399 
L 554.48684 161.089444 
L 555.790639 162.322208 
L 557.094437 164.99295 
L 559.702034 169.888553 
L 561.005833 171.507504 
L 562.309631 172.119113 
L 563.61343 173.089467 
L 564.917228 174.537049 
L 566.221027 175.201739 
L 567.524825 175.263442 
L 568.828624 176.630216 
L 570.132422 177.812691 
L 571.436221 178.186077 
L 572.74002 179.479672 
L 575.347617 179.903763 
L 576.651415 180.575062 
L 577.955214 181.081869 
L 579.259012 181.913341 
L 580.562811 182.019185 
L 581.866609 182.564664 
L 584.474206 183.005828 
L 585.778005 183.310238 
L 590.993199 183.876431 
L 592.296997 184.190715 
L 593.600796 184.260226 
L 594.904594 184.52725 
L 596.208393 184.558783 
L 597.512192 184.876558 
L 600.119789 185.092662 
L 604.031184 185.377462 
L 606.638781 185.621755 
L 609.246378 185.822416 
L 615.765371 186.208142 
L 635.322349 187.049032 
L 640.537543 187.173741 
L 649.664132 187.530107 
L 682.259096 188.364345 
L 684.866693 188.499112 
L 691.385685 188.728585 
L 693.993282 188.862715 
L 696.600879 188.954182 
L 696.600879 188.954182 
" clip-path="url(#p7a7923e430-cifar10-svg)" style="fill: none; stroke: #0fa8f7; stroke-opacity: 0.3; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="line2d_54-cifar10-svg">
    <path d="M 531.018467 144.185004 
L 622.284363 144.278789 
L 696.600879 144.317712 
L 696.600879 144.317712 
" clip-path="url(#p7a7923e430-cifar10-svg)" style="fill: none; stroke: #ef402c; stroke-width: 2; stroke-linecap: square"/>
   </g>
   <g id="patch_13-cifar10-svg">
    <path d="M 522.739346 196.432 
L 522.739346 31.92 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_14-cifar10-svg">
    <path d="M 704.88 196.432 
L 704.88 31.92 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_15-cifar10-svg">
    <path d="M 522.739346 196.432 
L 704.88 196.432 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="patch_16-cifar10-svg">
    <path d="M 522.739346 31.92 
L 704.88 31.92 
" style="fill: none; stroke: #000000; stroke-width: 0.8; stroke-linejoin: miter; stroke-linecap: square"/>
   </g>
   <g id="text_28-cifar10-svg">
    <!-- Singular value distribution -->
    <g transform="translate(521.532173 25.92) scale(0.14 -0.14)">
     <defs>
      <path id="DejaVuSans-62-cifar10-svg" d="M 3116 1747 
Q 3116 2381 2855 2742 
Q 2594 3103 2138 3103 
Q 1681 3103 1420 2742 
Q 1159 2381 1159 1747 
Q 1159 1113 1420 752 
Q 1681 391 2138 391 
Q 2594 391 2855 752 
Q 3116 1113 3116 1747 
z
M 1159 2969 
Q 1341 3281 1617 3432 
Q 1894 3584 2278 3584 
Q 2916 3584 3314 3078 
Q 3713 2572 3713 1747 
Q 3713 922 3314 415 
Q 2916 -91 2278 -91 
Q 1894 -91 1617 61 
Q 1341 213 1159 525 
L 1159 0 
L 581 0 
L 581 4863 
L 1159 4863 
L 1159 2969 
z
" transform="scale(0.015625)"/>
      <path id="DejaVuSans-6f-cifar10-svg" d="M 1959 3097 
Q 1497 3097 1228 2736 
Q 959 2375 959 1747 
Q 959 1119 1226 758 
Q 1494 397 1959 397 
Q 2419 397 2687 759 
Q 2956 1122 2956 1747 
Q 2956 2369 2687 2733 
Q 2419 3097 1959 3097 
z
M 1959 3584 
Q 2709 3584 3137 3096 
Q 3566 2609 3566 1747 
Q 3566 888 3137 398 
Q 2709 -91 1959 -91 
Q 1206 -91 779 398 
Q 353 888 353 1747 
Q 353 2609 779 3096 
Q 1206 3584 1959 3584 
z
" transform="scale(0.015625)"/>
     </defs>
     <use xlink:href="#DejaVuSans-53-cifar10-svg"/>
     <use xlink:href="#DejaVuSans-69-cifar10-svg" transform="translate(63.476562 0)"/>
     <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(91.259766 0)"/>
     <use xlink:href="#DejaVuSans-67-cifar10-svg" transform="translate(154.638672 0)"/>
     <use xlink:href="#DejaVuSans-75-cifar10-svg" transform="translate(218.115234 0)"/>
     <use xlink:href="#DejaVuSans-6c-cifar10-svg" transform="translate(281.494141 0)"/>
     <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(309.277344 0)"/>
     <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(370.556641 0)"/>
     <use xlink:href="#DejaVuSans-20-cifar10-svg" transform="translate(411.669922 0)"/>
     <use xlink:href="#DejaVuSans-76-cifar10-svg" transform="translate(443.457031 0)"/>
     <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(502.636719 0)"/>
     <use xlink:href="#DejaVuSans-6c-cifar10-svg" transform="translate(563.916016 0)"/>
     <use xlink:href="#DejaVuSans-75-cifar10-svg" transform="translate(591.699219 0)"/>
     <use xlink:href="#DejaVuSans-65-cifar10-svg" transform="translate(655.078125 0)"/>
     <use xlink:href="#DejaVuSans-20-cifar10-svg" transform="translate(716.601562 0)"/>
     <use xlink:href="#DejaVuSans-64-cifar10-svg" transform="translate(748.388672 0)"/>
     <use xlink:href="#DejaVuSans-69-cifar10-svg" transform="translate(811.865234 0)"/>
     <use xlink:href="#DejaVuSans-73-cifar10-svg" transform="translate(839.648438 0)"/>
     <use xlink:href="#DejaVuSans-74-cifar10-svg" transform="translate(891.748047 0)"/>
     <use xlink:href="#DejaVuSans-72-cifar10-svg" transform="translate(930.957031 0)"/>
     <use xlink:href="#DejaVuSans-69-cifar10-svg" transform="translate(972.070312 0)"/>
     <use xlink:href="#DejaVuSans-62-cifar10-svg" transform="translate(999.853516 0)"/>
     <use xlink:href="#DejaVuSans-75-cifar10-svg" transform="translate(1063.330078 0)"/>
     <use xlink:href="#DejaVuSans-74-cifar10-svg" transform="translate(1126.708984 0)"/>
     <use xlink:href="#DejaVuSans-69-cifar10-svg" transform="translate(1165.917969 0)"/>
     <use xlink:href="#DejaVuSans-6f-cifar10-svg" transform="translate(1193.701172 0)"/>
     <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(1254.882812 0)"/>
    </g>
   </g>
   <g id="legend_1-cifar10-svg">
    <g id="line2d_55-cifar10-svg">
     <path d="M 553.99 50.257813 
L 567.99 50.257813 
L 581.99 50.257813 
" style="fill: none; stroke: #0fa8f7; stroke-width: 2; stroke-linecap: square"/>
    </g>
    <g id="text_29-cifar10-svg">
     <!-- AdamW -->
     <g transform="translate(593.19 55.157813) scale(0.14 -0.14)">
      <defs>
       <path id="DejaVuSans-6d-cifar10-svg" d="M 3328 2828 
Q 3544 3216 3844 3400 
Q 4144 3584 4550 3584 
Q 5097 3584 5394 3201 
Q 5691 2819 5691 2113 
L 5691 0 
L 5113 0 
L 5113 2094 
Q 5113 2597 4934 2840 
Q 4756 3084 4391 3084 
Q 3944 3084 3684 2787 
Q 3425 2491 3425 1978 
L 3425 0 
L 2847 0 
L 2847 2094 
Q 2847 2600 2669 2842 
Q 2491 3084 2119 3084 
Q 1678 3084 1418 2786 
Q 1159 2488 1159 1978 
L 1159 0 
L 581 0 
L 581 3500 
L 1159 3500 
L 1159 2956 
Q 1356 3278 1631 3431 
Q 1906 3584 2284 3584 
Q 2666 3584 2933 3390 
Q 3200 3197 3328 2828 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-57-cifar10-svg" d="M 213 4666 
L 850 4666 
L 1831 722 
L 2809 4666 
L 3519 4666 
L 4500 722 
L 5478 4666 
L 6119 4666 
L 4947 0 
L 4153 0 
L 3169 4050 
L 2175 0 
L 1381 0 
L 213 4666 
z
" transform="scale(0.015625)"/>
      </defs>
      <use xlink:href="#DejaVuSans-41-cifar10-svg"/>
      <use xlink:href="#DejaVuSans-64-cifar10-svg" transform="translate(66.658203 0)"/>
      <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(130.134766 0)"/>
      <use xlink:href="#DejaVuSans-6d-cifar10-svg" transform="translate(191.414062 0)"/>
      <use xlink:href="#DejaVuSans-57-cifar10-svg" transform="translate(288.826172 0)"/>
     </g>
    </g>
    <g id="line2d_56-cifar10-svg">
     <path d="M 553.99 70.807188 
L 567.99 70.807188 
L 581.99 70.807188 
" style="fill: none; stroke: #ef402c; stroke-width: 2; stroke-linecap: square"/>
    </g>
    <g id="text_30-cifar10-svg">
     <!-- manifold Muon -->
     <g transform="translate(593.19 75.707188) scale(0.14 -0.14)">
      <defs>
       <path id="DejaVuSans-66-cifar10-svg" d="M 2375 4863 
L 2375 4384 
L 1825 4384 
Q 1516 4384 1395 4259 
Q 1275 4134 1275 3809 
L 1275 3500 
L 2222 3500 
L 2222 3053 
L 1275 3053 
L 1275 0 
L 697 0 
L 697 3053 
L 147 3053 
L 147 3500 
L 697 3500 
L 697 3744 
Q 697 4328 969 4595 
Q 1241 4863 1831 4863 
L 2375 4863 
z
" transform="scale(0.015625)"/>
       <path id="DejaVuSans-4d-cifar10-svg" d="M 628 4666 
L 1569 4666 
L 2759 1491 
L 3956 4666 
L 4897 4666 
L 4897 0 
L 4281 0 
L 4281 4097 
L 3078 897 
L 2444 897 
L 1241 4097 
L 1241 0 
L 628 0 
L 628 4666 
z
" transform="scale(0.015625)"/>
      </defs>
      <use xlink:href="#DejaVuSans-6d-cifar10-svg"/>
      <use xlink:href="#DejaVuSans-61-cifar10-svg" transform="translate(97.412109 0)"/>
      <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(158.691406 0)"/>
      <use xlink:href="#DejaVuSans-69-cifar10-svg" transform="translate(222.070312 0)"/>
      <use xlink:href="#DejaVuSans-66-cifar10-svg" transform="translate(249.853516 0)"/>
      <use xlink:href="#DejaVuSans-6f-cifar10-svg" transform="translate(285.058594 0)"/>
      <use xlink:href="#DejaVuSans-6c-cifar10-svg" transform="translate(346.240234 0)"/>
      <use xlink:href="#DejaVuSans-64-cifar10-svg" transform="translate(374.023438 0)"/>
      <use xlink:href="#DejaVuSans-20-cifar10-svg" transform="translate(437.5 0)"/>
      <use xlink:href="#DejaVuSans-4d-cifar10-svg" transform="translate(469.287109 0)"/>
      <use xlink:href="#DejaVuSans-75-cifar10-svg" transform="translate(555.566406 0)"/>
      <use xlink:href="#DejaVuSans-6f-cifar10-svg" transform="translate(618.945312 0)"/>
      <use xlink:href="#DejaVuSans-6e-cifar10-svg" transform="translate(680.126953 0)"/>
     </g>
    </g>
   </g>
  </g>
 </g>
 <defs>
  <clipPath id="pc22f2d41b5-cifar10-svg">
   <rect x="57.62" y="31.92" width="182.140654" height="164.512"/>
  </clipPath>
  <clipPath id="pa7d198305a-cifar10-svg">
   <rect x="290.179673" y="31.92" width="182.140654" height="164.512"/>
  </clipPath>
  <clipPath id="p7a7923e430-cifar10-svg">
   <rect x="522.739346" y="31.92" width="182.140654" height="164.512"/>
  </clipPath>
 </defs>
</svg>

<figcaption>Training a small MLP for 3 epochs on the CIFAR-10 dataset. The different lightly shaded blue curves show different weight decay settings for AdamW. Results were averaged over 3 random seeds. The manifold Muon optimizer attained higher train and test accuracy than AdamW. The third plot shows the final singular value distribution of the first weight matrix for the best performing learning rate: the singular values after training with manifold Muon are all close to 1. Manifold Muon increased the wall clock time per step compared to AdamW, although this could be improved by running fewer steps of dual ascent or adding momentum to the algorithm and running dual ascent online. Depending on other systems bottlenecks, the overhead may not be an issue.</figcaption>
</figure>
<h2 id="modular-manifolds">Modular manifolds</h2>
<p>So far in this post, we have discussed manifold constraints for individual parameter tensors and co-designed optimization logic for these constraints. A question we have not answered is: what happens when we combine layers to build networks? Can we think about individual layers in isolation&mdash;or do we need to be careful about interactions between layers and modify the optimization logic in response? The goal of this section is to point out that there is a way to extend the reasoning we introduced in the previous two sections to the case of whole networks, and we call this <em>the theory of modular manifolds</em>.<label for="sn-modular-manifolds-1" class="sidenote-number"></label><input type="checkbox" id="sn-modular-manifolds-1" class="margin-toggle"/><span class="sidenote">The theory of modular manifolds builds on research I did with my friend Tim Large, my postdoc advisor Phillip Isola, my PhD advisor Yisong Yue and many other amazing collaborators.</span> At the end of the section, we provide some links to learn more.</p>
<p>The idea of modular manifolds is to build an abstraction that tells us how to budget learning rates across layers. The actual optimization logic in each layer ends up being the same as what we already worked out, except that the learning rate for a layer is modified depending on where the layer appears in the network. The abstraction rests upon a key observation made in our paper on the <a href="https://arxiv.org/abs/2405.14813">modular norm</a>, that budgeting learning rates&mdash;both across layers and when scaling up individual layers&mdash;is intimately tied to understanding the Lipschitz sensitivity of the network output with respect to the weights. The abstraction tracks this sensitivity as we build the network, and manifold constraints help us get a much tighter understanding of this sensitivity.</p>
<p>The starting point for the abstraction is to think of any neural network module&mdash;from a layer to a whole transformer&mdash;as a mathematical object with three attributes:</p>
<ol>
<li>A forward function $f:\mathcal{W} \times \mathcal{X} \to \mathcal{Y}$ that maps from a parameter space $\mathcal{W} = \mathbb{R}^d$ and an input space $\mathcal{X}$ to an output space $\mathcal{Y}$.</li>
<li>A submanifold of the weight space $\mathcal{M}\subset\mathcal{W}$ that the weights are constrained to.</li>
<li>A norm $\|\cdot\| : \mathcal{W} \to \mathbb{R}$ that acts as a measuring stick on weight space.</li>
</ol>
<p>For example, a linear module equipped with the spectral norm and constrained to the Stiefel manifold, for which we have already worked out an optimizer, would be written:</p>
$$ \mathsf{StiefelLinear} = \begin{cases}(W, x) \mapsto Wx, & \text{(forward function)}\\ \mathsf{Stiefel}(m,n), & \text{(manifold)}\\ \|\cdot\|_\mathrm{spectral}. & \text{(norm)}\end{cases}$$<p>Provided that an input $x$ to the $\mathsf{StiefelLinear}$ module has unit $\ell_2$ norm, then $\mathsf{StiefelLinear}$ is Lipschitz with respect to its weights in the module&rsquo;s assigned norm with Lipschitz constant one:<label for="sn-stiefel-lipschitz" class="sidenote-number"></label><input type="checkbox" id="sn-stiefel-lipschitz" class="margin-toggle"/><span class="sidenote">This argument can be extended to the RMS norm on the input and the RMS&ndash;RMS operator norm on the weights.</span></p>
$$\|(W + \Delta W) x - Wx\|_2 \leq \|\Delta W\|_\mathrm{spectral} \times \|x\|_2 = \|\Delta W\|_\mathrm{spectral}.$$<p>This type of Lipschitz statement helps us understand how to scale weight updates to this module since it gives us a bound on how much the output can change when we perturb the weights. But when we compose two modules, can we automatically compile a Lipschitz statement on the joint weight space of the new module? The answer turns out to be yes, if we follow special rules for building the new module:</p>
<ol>
<li>The new forward function $f_3$ is given by composing the two existing forward functions $f_1$ and $f_2$:
$$f_3((w_1, w_2), x) := f_2(w_2, f_1(w_1, x)). \qquad$$</li>
<li>The new manifold constraint $\mathcal{M}_3$ is just the Cartesian product (see <a href="#fig:product-manifold">Figure <span data-ref="product-manifold"></span></a> for a fun example) of the two existing manifolds $\mathcal{M}_1$ and $\mathcal{M}_2$:
$$\mathcal{M}_3 = \mathcal{M}_1 \times \mathcal{M}_2. \qquad$$</li>
<li>The new norm function is the max of the two existing norm functions weighted by special scalar coefficients $s_1$ and $s_2$. Letting $\|\cdot\|_1$ denote the first module&rsquo;s norm and $\|\cdot\|_2$ denote the second module&rsquo;s norm, the new norm $\|\cdot\|_3$ is given by:
$$\|(w_1, w_2)\|_3 := \max(s_1\cdot \|w_1\|_1, s_2\cdot \|w_2\|_2). \qquad$$</li>
</ol>
<p>When we use this composite norm to derive optimizers&mdash;following the same recipe we used in the first two sections of this post&mdash;we end up deriving separate optimizers for each layer, but the scalar coefficients $s_i$ budget the learning rates across layers.</p>
<p>We give much more detail on this construction, including extending it to other ways of combining modules, in our paper on the <a href="https://arxiv.org/abs/2405.14813">modular norm</a>&mdash;although the paper does not cover manifold optimization. You can also check out our paper on <a href="https://arxiv.org/abs/2410.21265">modular duality</a> for more on building optimizers in the modular norm. The <a href="https://modula.systems">Modula project</a> builds toward a programmatic implementation of this construction.</p>
<figure id="fig:product-manifold">
<svg xmlns="http://www.w3.org/2000/svg" width="735" height="272" fill="none" viewBox="0 0 735 272"><path fill="#f5f5f5" d="M0 0h735v272H0z"/><path fill="#fff" d="M0 0h735v272H0z"/><text xml:space="preserve" fill="#000" font-family="GT America Trial" font-size="32" letter-spacing="0em" style="white-space:pre"><tspan x="292.344" y="150.872">=</tspan></text><circle cx="436" cy="136" r="65" fill="#d4d4d4"/><text xml:space="preserve" fill="#000" font-family="GT America Trial" font-size="28" letter-spacing="0em" style="white-space:pre"><tspan x="553.008" y="146.888">x</tspan></text><path fill="#2a2a2a" d="M629 67h3v139h-3z"/><path fill="url(#paint0_linear_443_18269-product-manifold-svg)" d="m184.743 49.687.375-.356c8.029-7.254 26.675-.878 42.052 14.499 15.621 15.62 21.952 34.615 14.142 42.426L131.71 215.857l-56.568-56.568z"/><path fill="url(#paint1_linear_443_18269-product-manifold-svg)" stroke="#fff" stroke-width="4" d="M90.698 200.302c-7.638-7.639-12.933-16.035-15.374-23.361-2.484-7.452-1.849-13.156 1.232-16.237s8.786-3.717 16.238-1.233c7.325 2.442 15.722 7.736 23.36 15.375 7.639 7.638 12.933 16.035 15.375 23.36 2.484 7.452 1.848 13.157-1.233 16.238s-8.785 3.716-16.238 1.232c-7.325-2.442-15.721-7.736-23.36-15.374Z"/><defs><linearGradient id="paint0_linear_443_18269-product-manifold-svg" x1="144" x2="200.5" y1="93" y2="152.5" gradientUnits="userSpaceOnUse"><stop stop-color="#d4d4d4"/><stop offset="1" stop-color="#bebebe"/></linearGradient><linearGradient id="paint1_linear_443_18269-product-manifold-svg" x1="77.73" x2="128.551" y1="159.271" y2="223.06" gradientUnits="userSpaceOnUse"><stop stop-color="#d4d4d4"/><stop offset="1" stop-color="#bebebe"/></linearGradient></defs></svg>
<figcaption>The Cartesian product is a simple way to glue together two manifolds. For example, the product of a line and a disk is a cylinder. We get one copy of the disk at every point on the line.</figcaption>
</figure>
<h2 id="directions-for-future-work">Directions for future work</h2>
<p>We are excited about any research that tries to make neural network training as principled and automatic as the forward pass. The ideas in this post benefitted strongly from interactions with external researchers like Jianlin Su and Franz Louis Cesista. We would love to see more work on these topics from the community.</p>
<p>Some possible directions for future work are:</p>
<ul>
<li><strong>Modularity.</strong> What manifolds should attention heads live on? Should embeddings be constrained differently than unembeddings? We can mix-and-match constraints in different parts of the network, or leave some tensors unconstrained.</li>
<li><strong>Numerics.</strong> Manifold constraints also place constraints on the range of values that individual weight entries can take. Does this impact numerics, or make low-precision training easier?</li>
<li><strong>Convex optimization.</strong> The manifold Muon algorithm involves running dual ascent. Can we apply more sophisticated convex optimization techniques to solve the dual problem faster or more reliably?</li>
<li><strong>Convergence analysis.</strong> How fast do these algorithms converge? Does good conditioning of the weight matrices benefit convergence? Is there more that we can say theoretically?</li>
<li><strong>Regularization.</strong> Manifold constraints implicitly regularize the model. Could we design constraints or tune their radii to improve generalization?</li>
<li><strong>Architecture-optimizer co-design.</strong> While hard manifold constraints may not ultimately be the right way to constrain weight matrices, they exemplify the idea of tightly co-designing optimization algorithms with architecural components. Are there more opportunities here?</li>
<li><strong>Non-Riemannian geometry.</strong> Most work on manifold optimization works in a Riemannian world where distances are induced by inner products and norm balls are ellipsoids. But neural networks are different: matrices act as operators, and operator norms like the spectral norm do not emerge from inner products. This implies, for example, that norm balls can have sharp corners and there is no unique gradient flow. Is there more to be discovered in this non-Riemannian world?</li>
<li><strong>Practical implementation.</strong> Applying these techniques at scale requires efficient manifold operations on GPUs. The recent <a href="https://arxiv.org/abs/2505.16932">Polar Express</a> paper shows promise for fast matrix sign computation. What other algorithmic innovations do we need?</li>
</ul>
<h2 id="further-reading">Further reading</h2>
<ul>
<li>
<p><strong>Manifold optimization.</strong> <a href="https://press.princeton.edu/absil">Absil, Mahony &amp; Sepulchre</a>&rsquo;s textbook is a standard reference. For the Stiefel manifold specifically, see <a href="https://math.mit.edu/~edelman/publications/geometry_of_algorithms.pdf">Edelman et al, 1998</a>. These works live in a Riemannian world. Similarly most machine learning papers that consider optimization on the Stiefel manifold take a Riemannian point of view: see <a href="https://arxiv.org/abs/2002.01113">Li et al, 2020</a>, <a href="https://arxiv.org/abs/2205.14173">Kong et al, 2022</a> and <a href="https://arxiv.org/abs/2508.17901">Park et al, 2025</a> for some examples.</p>
</li>
<li>
<p><strong>Non-Riemannian geometry in machine learning.</strong> <a href="https://arxiv.org/abs/1708.00523">Thomas Flynn&rsquo;s paper</a> from 2017 on duality structure gradient descent characterizes the neural network weight space as a <em>Finsler manifold</em>, meaning a manifold equipped with a norm. It is well worth a read. Also see Jianlin Su&rsquo;s <a href="https://kexue.fm/archives/11221">recent blog post</a> on Stiefel Muon as well as Franz Louis Cesista&rsquo;s <a href="https://leloykun.github.io/ponder/steepest-descent-stiefel/">blog post</a> on a heuristic solution to Muon on the Stiefel manifold. Franz also wrote a <a href="https://leloykun.github.io/ponder/steepest-descent-finsler/">followup blog post</a> generalizing the solution presented here. The <a href="https://arxiv.org/abs/2502.07529">Scion paper</a> imposes weight constraints a different way via convex combinations and <a href="https://papers.nips.cc/paper_files/paper/2015/hash/f50a6c02a3fc5a3a5d4d9391f05f3efc-Abstract.html">Carlson et al, 2015</a> wrote an early paper on (unconstrained) spectral descent.</p>
</li>
<li>
<p><strong>The Modula project.</strong> The goal of the Modula project is to build a library that automatically compiles steepest descent optimizers along with Lipschitz statements for general architectures. Check out the project page at <a href="https://modula.systems">https://modula.systems</a> as well as our paper on the <a href="https://arxiv.org/abs/2405.14813">modular norm</a> and <a href="https://arxiv.org/abs/2410.21265">modular duality</a>. Our <a href="https://arxiv.org/abs/2409.20325">optimization anthology</a> also provides an accessible route into this space of ideas.</p>
</li>
<li>
<p><strong>Lipschitz-constrained deep learning.</strong> There has been a lot of work on this topic. For example, check out <a href="https://theses.hal.science/tel-04674274v1">Louis Béthune</a> and <a href="https://dspace.mit.edu/bitstream/handle/1721.1/129313/1227782217-MIT.pdf?sequence=1&amp;isAllowed=y">Tsui-Wei Weng&rsquo;s</a> PhD theses. Usually work on this topic does not connect weight-Lipschitzness to optimizer design. See also <a href="https://arxiv.org/abs/1811.05381">Anil et al, 2018</a> and our paper <a href="https://arxiv.org/abs/2507.13338">Newhouse et al, 2025</a>.</p>
</li>
</ul>
<h2 id="citation">Citation</h2>
<p>Please cite this work as:</p>
<pre tabindex="0"><code>Jeremy Bernstein, &#34;Modular Manifolds&#34;,
Thinking Machines Lab: Connectionism, Sep 2025.
</code></pre><p>Or use the BibTeX citation:</p>
<pre tabindex="0"><code>@article{bernstein2025manifolds,
  author = {Jeremy Bernstein},
  title = {Modular Manifolds},
  journal = {Thinking Machines Lab: Connectionism},
  year = {2025},
  note = {https://thinkingmachines.ai/blog/modular-manifolds/},
  doi = {10.64434/tml.20250926}
}
</code></pre><script>
// Auto-number figure references
document.addEventListener('DOMContentLoaded', function() {
  // Find all figures with IDs
  const figures = document.querySelectorAll('figure[id^="fig:"]');
  const figureNumbers = new Map();

  // Assign numbers to figures based on document order
  figures.forEach((fig, index) => {
    const id = fig.id.replace('fig:', '');
    figureNumbers.set(id, index + 1);
  });

  // Update all figure references
  document.querySelectorAll('span[data-ref]').forEach(span => {
    const ref = span.getAttribute('data-ref');
    const num = figureNumbers.get(ref);
    if (num) {
      span.textContent = num;
    }
  });
});
</script>
    
  </article>

  <div class="paginator">
    
    <a class="link" href="https://thinkingmachines.ai/blog/defeating-nondeterminism-in-llm-inference/" title="Defeating Nondeterminism in LLM Inference">prev</a>
    

    <a href="#" id="back-to-top" class="link" title="Go to top">back to top</a>

    
    <a class="link" href="https://thinkingmachines.ai/blog/lora/" title="LoRA Without Regret">next</a>
    
  </div>

  
  
  
  
  
  

  
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      
      const prevLink = document.querySelector('.paginator a:first-child');
      const nextLink = document.querySelector('.paginator a:last-child');

      const prevUrl = prevLink && prevLink.href !== window.location.href ? prevLink.href : null;
      const nextUrl = nextLink && nextLink.href !== window.location.href ? nextLink.href : null;

      
      document.addEventListener('keydown', function(e) {
        
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
          return;
        }

        
        if (e.keyCode === 37 && prevUrl) {
          e.preventDefault();
          window.location.href = prevUrl;
        }

        
        if (e.keyCode === 39 && nextUrl) {
          e.preventDefault();
          window.location.href = nextUrl;
        }
      });
    });
  </script>
  

  
  
</main>

    <footer id="footer">
  <div>
    <span><a href="/">Thinking Machines Lab</a> © 2025</span><span class="footer-separator" id="first-footer-separator">·</span><span><a href="/legal/terms">Terms of service</a></span><span class="footer-separator">·</span><span><a href="/legal/privacy">Privacy notice</a></span>
  </div>
</footer>
  </div>

  
  
  <script src="/js/script.min.4093dc550c9ad99ac0e65f35825652be69a5baa12f3740fed8f70266298353f6.js" integrity="sha256-QJPcVQya2ZrA5l81glZSvmmluqEvN0D&#43;2PcCZimDU/Y=" defer></script>

  
  

  
  

  
  

</body>

</html>